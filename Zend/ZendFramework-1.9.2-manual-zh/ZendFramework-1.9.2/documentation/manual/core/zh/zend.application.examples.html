<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>4.4. Examples</title>
<link rel="stylesheet" href="dbstyle.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.72.0">
<link rel="start" href="index.html" title="Zend Framework手册 中文版">
<link rel="up" href="zend.application.html" title="第 4 章 Zend_Application">
<link rel="prev" href="zend.application.theory-of-operation.html" title="4.3. Theory of Operation">
<link rel="next" href="zend.application.core-functionality.html" title="4.5. Core Functionality">
<link rel="chapter" href="introduction.html" title="第 1 章 Zend Framework简介">
<link rel="chapter" href="zend.acl.html" title="第 2 章 Zend_Acl">
<link rel="chapter" href="zend.amf.html" title="第 3 章 Zend_Amf">
<link rel="chapter" href="zend.application.html" title="第 4 章 Zend_Application">
<link rel="chapter" href="zend.auth.html" title="第 5 章 Zend_Auth">
<link rel="chapter" href="zend.cache.html" title="第 6 章 Zend_Cache">
<link rel="chapter" href="zend.captcha.html" title="第 7 章 Zend_Captcha">
<link rel="chapter" href="zend.codegenerator.html" title="第 8 章 Zend_CodeGenerator">
<link rel="chapter" href="zend.config.html" title="第 9 章 Zend_Config">
<link rel="chapter" href="zend.config.writer.html" title="第 10 章 Zend_Config_Writer">
<link rel="chapter" href="zend.console.getopt.html" title="第 11 章 Zend_Console_Getopt">
<link rel="chapter" href="zend.controller.html" title="第 12 章 Zend_Controller">
<link rel="chapter" href="zend.currency.html" title="第 13 章 Zend_Currency">
<link rel="chapter" href="zend.date.html" title="第 14 章 Zend_Date">
<link rel="chapter" href="zend.db.html" title="第 15 章 Zend_Db">
<link rel="chapter" href="zend.debug.html" title="第 16 章 Zend_Debug">
<link rel="chapter" href="zend.dojo.html" title="第 17 章 Zend_Dojo">
<link rel="chapter" href="zend.dom.html" title="第 18 章 Zend_Dom">
<link rel="chapter" href="zend.exception.html" title="第 19 章 Zend_Exception">
<link rel="chapter" href="zend.feed.html" title="第 20 章 Zend_Feed">
<link rel="chapter" href="zend.file.html" title="第 21 章 Zend_File">
<link rel="chapter" href="zend.filter.html" title="第 22 章 Zend_Filter">
<link rel="chapter" href="zend.form.html" title="第 23 章 Zend_Form">
<link rel="chapter" href="zend.gdata.html" title="第 24 章 Zend_Gdata">
<link rel="chapter" href="zend.http.html" title="第 25 章 Zend_Http">
<link rel="chapter" href="zend.infocard.html" title="第 26 章 Zend_InfoCard">
<link rel="chapter" href="zend.json.html" title="第 27 章 Zend_Json">
<link rel="chapter" href="zend.layout.html" title="第 28 章 Zend_Layout">
<link rel="chapter" href="zend.ldap.html" title="第 29 章 Zend_Ldap">
<link rel="chapter" href="zend.loader.html" title="第 30 章 Zend_Loader">
<link rel="chapter" href="zend.locale.html" title="第 31 章 Zend_Locale">
<link rel="chapter" href="zend.log.html" title="第 32 章 Zend_Log">
<link rel="chapter" href="zend.mail.html" title="第 33 章 Zend_Mail">
<link rel="chapter" href="zend.measure.html" title="第 34 章 Zend_Measure">
<link rel="chapter" href="zend.memory.html" title="第 35 章 Zend_Memory">
<link rel="chapter" href="zend.mime.html" title="第 36 章 Zend_Mime">
<link rel="chapter" href="zend.navigation.html" title="第 37 章 Zend_Navigation">
<link rel="chapter" href="zend.openid.html" title="第 38 章 Zend_OpenId">
<link rel="chapter" href="zend.paginator.html" title="第 39 章 Zend_Paginator">
<link rel="chapter" href="zend.pdf.html" title="第 40 章 Zend_Pdf">
<link rel="chapter" href="zend.progressbar.html" title="第 41 章 Zend_ProgressBar">
<link rel="chapter" href="zend.queue.html" title="第 42 章 Zend_Queue">
<link rel="chapter" href="zend.reflection.html" title="第 43 章 Zend_Reflection">
<link rel="chapter" href="zend.registry.html" title="第 44 章 Zend_Registry">
<link rel="chapter" href="zend.rest.html" title="第 45 章 Zend_Rest">
<link rel="chapter" href="zend.search.lucene.html" title="第 46 章 Zend_Search_Lucene">
<link rel="chapter" href="zend.server.html" title="第 47 章 Zend_Server">
<link rel="chapter" href="zend.service.html" title="第 48 章 Zend_Service">
<link rel="chapter" href="zend.session.html" title="第 49 章 Zend_Session">
<link rel="chapter" href="zend.soap.html" title="第 50 章 Zend_Soap">
<link rel="chapter" href="zend.tag.html" title="第 51 章 Zend_Tag">
<link rel="chapter" href="zend.test.html" title="第 52 章 Zend_Test">
<link rel="chapter" href="zend.text.html" title="第 53 章 Zend_Text">
<link rel="chapter" href="zend.timesync.html" title="第 54 章 Zend_TimeSync">
<link rel="chapter" href="zend.tool.framework.html" title="第 55 章 Zend_Tool_Framework">
<link rel="chapter" href="zend.tool.project.html" title="第 56 章 Zend_Tool_Project">
<link rel="chapter" href="zend.translate.html" title="第 57 章 Zend_Translate">
<link rel="chapter" href="zend.uri.html" title="第 58 章 Zend_Uri">
<link rel="chapter" href="zend.validate.html" title="第 59 章 Zend_Validate">
<link rel="chapter" href="zend.version.html" title="第 60 章 Zend_Version">
<link rel="chapter" href="zend.view.html" title="第 61 章 Zend_View">
<link rel="chapter" href="zend.wildfire.html" title="第 62 章 Zend_Wildfire">
<link rel="chapter" href="zend.xmlrpc.html" title="第 63 章 Zend_XmlRpc">
<link rel="chapter" href="zendx.console.process.unix.html" title="第 64 章 ZendX_Console_Process_Unix">
<link rel="chapter" href="zendx.jquery.html" title="第 65 章 ZendX_JQuery">
<link rel="appendix" href="requirements.html" title="附录 A. 系统需求">
<link rel="appendix" href="coding-standard.html" title="附录 B. Zend Framework 的 PHP 编码标准">
<link rel="appendix" href="doc-standard.html" title="附录 C. Zend Framework Documentation Standard">
<link rel="appendix" href="project-structure.html" title="附录 D. Recommended Project Structure for Zend Framework MVC Applications">
<link rel="appendix" href="performance.html" title="附录 E. Zend Framework Performance Guide">
<link rel="appendix" href="copyrights.html" title="附录 F. 版权信息">
<link rel="index" href="the.index.html" title="索引">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader"><table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">4.4. Examples</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="zend.application.theory-of-operation.html">上一页</a> </td>
<th width="60%" align="center">第 4 章 Zend_Application</th>
<td width="20%" align="right"> <a accesskey="n" href="zend.application.core-functionality.html">下一页</a>
</td>
</tr>
</table></div>
<div class="sect1" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="zend.application.examples"></a>4.4. Examples</h2></div></div></div>
<p>
        The Bootstrap class itself will typically be fairly minimal; often,
        it will simply be an empty stub extending the base bootstrap class:
    </p>
<pre class="programlisting">
class Bootstrap extends Zend_Application_Bootstrap_Bootstrap
{
}
</pre>
<p>
        With a corresponding configuration file:
    </p>
<pre class="programlisting">
; APPLICATION_PATH/configs/application.ini
[production]
bootstrap.path = APPLICATION_PATH "/Bootstrap.php"
bootstrap.class = "Bootstrap"
resources.frontController.controllerDirectory = APPLICATION_PATH "/controllers"

[testing : production]
[development : production]
</pre>
<p>
        However, should custom initialization be necessary, you have two
        choices. First, you can write methods prefixed with <span class="emphasis"><em>_init</em></span>
        to specify discrete code to bootstrap. These methods will be called by
        <code class="methodname">bootstrap()</code>, and can also be called as if they were public methods:
        <span class="emphasis"><em>bootstrap&lt;resource&gt;()</em></span>. They should accept an optional
        array of options.
    </p>
<p>
        If your resource method returns a value, it will be stored in a
        container in the bootstrap. This can be useful when different resources
        need to interact (such as one resource injecting itself into another).
        The method <code class="methodname">getResource()</code> can then be used to retrieve those
        values.
    </p>
<p>
        The example below shows a resource method for initializing the request
        object. It makes use of dependency tracking (it depends on the front
        controller resource), fetching a resource from the bootstrap, and
        returning a value to store in the bootstrap.
    </p>
<pre class="programlisting">
class Bootstrap extends Zend_Application_Bootstrap_Bootstrap
{
    protected function _initRequest(array $options = array())
    {
        // Ensure front controller instance is present, and fetch it
        $this-&gt;bootstrap('FrontController');
        $front = $this-&gt;getResource('FrontController');

        // Initialize the request object
        $request = new Zend_Controller_Request_Http();
        $request-&gt;setBaseUrl('/foo');

        // Add it to the front controller
        $front-&gt;setRequest($request);

        // Bootstrap will store this value in the 'request' key of its container
        return $request;
    }
}
</pre>
<p>
        Note in this example the call to <code class="methodname">bootstrap()</code>;
        this ensures that the front controller has been initialized prior to
        calling this method. That call may trigger either a resource or another
        method in the class.
    </p>
<p>
        The other option is to use resource plugins. Resource plugins are
        objects that perform specific initializations, and may be specified:
    </p>
<div class="itemizedlist"><ul type="disc">
<li><p>
                When instantiating the <code class="classname">Zend_Application</code> object
            </p></li>
<li><p>
                During initialization of the bootstrap object
            </p></li>
<li><p>
                By explicitly enabling them via method calls to the bootstrap
                object
            </p></li>
</ul></div>
<p>
        Resource plugins implement
        <code class="classname">Zend_Application_Resource_ResourceAbstract</code>,
        which defines simply that they allow injection of the caller and
        options, and that they have an <code class="methodname">init()</code> method. As an
        example, a custom "View" bootstrap resource might look like the
        following:
    </p>
<pre class="programlisting">
class My_Bootstrap_Resource_View
    extends Zend_Application_Resource_ResourceAbstract
{
    public function init()
    {
        $view = new Zend_View($this-&gt;getOptions());
        Zend_Dojo::enableView($view);

        $view-&gt;doctype('XHTML1_STRICT');
        $view-&gt;headTitle()-&gt;setSeparator(' - ')-&gt;append('My Site');
        $view-&gt;headMeta()-&gt;appendHttpEquiv('Content-Type',
                                           'text/html; charset=utf-8');

        $view-&gt;dojo()-&gt;setDjConfigOption('parseOnLoad', true)
                     -&gt;setLocalPath('/js/dojo/dojo.js')
                     -&gt;registerModulePath('../spindle', 'spindle')
                     -&gt;addStylesheetModule('spindle.themes.spindle')
                     -&gt;requireModule('spindle.main')
                     -&gt;disable();

        $viewRenderer = Zend_Controller_Action_HelperBroker::getStaticHelper(
            'ViewRenderer'
        );
        $viewRenderer-&gt;setView($view);

        return $view;
    }
}
</pre>
<p>
        To tell the bootstrap to use this, you would need to provide either the
        class name of the resource plugin, or a combination of a plugin loader prefix
        path and the short name of the resource plugin (e.g, "view"):
    </p>
<pre class="programlisting">
$application = new Zend_Application(
    APPLICATION_ENV,
    array(
        'resources' =&gt; array(
            'My_Bootstrap_Resource_View' =&gt; array(), // full class name; OR
            'view' =&gt; array(),                       // short name

            'FrontController' =&gt; array(
                'controllerDirectory' =&gt; APPLICATION_PATH . '/controllers',
            ),
        ),

        // For short names, define plugin paths:
        'pluginPaths = array(
            'My_Bootstrap_Resource' =&gt; 'My/Bootstrap/Resource',
        )
    )
);
</pre>
<p>
        Resource plugins can call on other resources and initializers by accessing the
        parent bootstrap:
    </p>
<pre class="programlisting">
class My_Bootstrap_Resource_Layout
    extends Zend_Application_Resource_ResourceAbstract
{
    public function init()
    {
        // ensure view is initialized...
        $this-&gt;getBootstrap()-&gt;bootstrap('view');

        // Get view object:
        $view = $this-&gt;getBootstrap()-&gt;getResource('view');

        // ...
    }
}
</pre>
<p>
        In normal usage, you would instantiate the application, bootstrap it,
        and run it:
    </p>
<pre class="programlisting">
$application = new Zend_Application(...);
$application-&gt;bootstrap()
            -&gt;run();
</pre>
<p>
        For a custom script, you might need to simply initialize specific
        resources:
    </p>
<pre class="programlisting">
$application = new Zend_Application(...);
$application-&gt;getBootstrap()-&gt;bootstrap('db');

$service = new Zend_XmlRpc_Server();
$service-&gt;setClass('Foo');  // uses database...
echo $service-&gt;handle();
</pre>
<p>
        Instead of using the <code class="methodname">bootstrap()</code> method to call the
        internal methods or resources, you may also use overloading:
    </p>
<pre class="programlisting">
$application = new Zend_Application(...);
$application-&gt;getBootstrap()-&gt;bootstrapDb();
</pre>
</div>
<div class="navfooter"><table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="zend.application.theory-of-operation.html">上一页</a> </td>
<td width="20%" align="center"><a accesskey="u" href="zend.application.html">上一级</a></td>
<td width="40%" align="right"> <a accesskey="n" href="zend.application.core-functionality.html">下一页</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">4.3. Theory of Operation </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td>
<td width="40%" align="right" valign="top"> 4.5. Core Functionality</td>
</tr>
</table></div>
<div class="revinfo"></div>
</body>
</html>
