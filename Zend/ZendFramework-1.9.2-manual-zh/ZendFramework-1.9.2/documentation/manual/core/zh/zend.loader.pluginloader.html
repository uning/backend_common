<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>30.4.  加载插件</title>
<link rel="stylesheet" href="dbstyle.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.72.0">
<link rel="start" href="index.html" title="Zend Framework手册 中文版">
<link rel="up" href="zend.loader.html" title="第 30 章 Zend_Loader">
<link rel="prev" href="zend.loader.autoloader-resource.html" title="30.3. Resource Autoloaders">
<link rel="next" href="zend.locale.html" title="第 31 章 Zend_Locale">
<link rel="chapter" href="introduction.html" title="第 1 章 Zend Framework简介">
<link rel="chapter" href="zend.acl.html" title="第 2 章 Zend_Acl">
<link rel="chapter" href="zend.amf.html" title="第 3 章 Zend_Amf">
<link rel="chapter" href="zend.application.html" title="第 4 章 Zend_Application">
<link rel="chapter" href="zend.auth.html" title="第 5 章 Zend_Auth">
<link rel="chapter" href="zend.cache.html" title="第 6 章 Zend_Cache">
<link rel="chapter" href="zend.captcha.html" title="第 7 章 Zend_Captcha">
<link rel="chapter" href="zend.codegenerator.html" title="第 8 章 Zend_CodeGenerator">
<link rel="chapter" href="zend.config.html" title="第 9 章 Zend_Config">
<link rel="chapter" href="zend.config.writer.html" title="第 10 章 Zend_Config_Writer">
<link rel="chapter" href="zend.console.getopt.html" title="第 11 章 Zend_Console_Getopt">
<link rel="chapter" href="zend.controller.html" title="第 12 章 Zend_Controller">
<link rel="chapter" href="zend.currency.html" title="第 13 章 Zend_Currency">
<link rel="chapter" href="zend.date.html" title="第 14 章 Zend_Date">
<link rel="chapter" href="zend.db.html" title="第 15 章 Zend_Db">
<link rel="chapter" href="zend.debug.html" title="第 16 章 Zend_Debug">
<link rel="chapter" href="zend.dojo.html" title="第 17 章 Zend_Dojo">
<link rel="chapter" href="zend.dom.html" title="第 18 章 Zend_Dom">
<link rel="chapter" href="zend.exception.html" title="第 19 章 Zend_Exception">
<link rel="chapter" href="zend.feed.html" title="第 20 章 Zend_Feed">
<link rel="chapter" href="zend.file.html" title="第 21 章 Zend_File">
<link rel="chapter" href="zend.filter.html" title="第 22 章 Zend_Filter">
<link rel="chapter" href="zend.form.html" title="第 23 章 Zend_Form">
<link rel="chapter" href="zend.gdata.html" title="第 24 章 Zend_Gdata">
<link rel="chapter" href="zend.http.html" title="第 25 章 Zend_Http">
<link rel="chapter" href="zend.infocard.html" title="第 26 章 Zend_InfoCard">
<link rel="chapter" href="zend.json.html" title="第 27 章 Zend_Json">
<link rel="chapter" href="zend.layout.html" title="第 28 章 Zend_Layout">
<link rel="chapter" href="zend.ldap.html" title="第 29 章 Zend_Ldap">
<link rel="chapter" href="zend.loader.html" title="第 30 章 Zend_Loader">
<link rel="chapter" href="zend.locale.html" title="第 31 章 Zend_Locale">
<link rel="chapter" href="zend.log.html" title="第 32 章 Zend_Log">
<link rel="chapter" href="zend.mail.html" title="第 33 章 Zend_Mail">
<link rel="chapter" href="zend.measure.html" title="第 34 章 Zend_Measure">
<link rel="chapter" href="zend.memory.html" title="第 35 章 Zend_Memory">
<link rel="chapter" href="zend.mime.html" title="第 36 章 Zend_Mime">
<link rel="chapter" href="zend.navigation.html" title="第 37 章 Zend_Navigation">
<link rel="chapter" href="zend.openid.html" title="第 38 章 Zend_OpenId">
<link rel="chapter" href="zend.paginator.html" title="第 39 章 Zend_Paginator">
<link rel="chapter" href="zend.pdf.html" title="第 40 章 Zend_Pdf">
<link rel="chapter" href="zend.progressbar.html" title="第 41 章 Zend_ProgressBar">
<link rel="chapter" href="zend.queue.html" title="第 42 章 Zend_Queue">
<link rel="chapter" href="zend.reflection.html" title="第 43 章 Zend_Reflection">
<link rel="chapter" href="zend.registry.html" title="第 44 章 Zend_Registry">
<link rel="chapter" href="zend.rest.html" title="第 45 章 Zend_Rest">
<link rel="chapter" href="zend.search.lucene.html" title="第 46 章 Zend_Search_Lucene">
<link rel="chapter" href="zend.server.html" title="第 47 章 Zend_Server">
<link rel="chapter" href="zend.service.html" title="第 48 章 Zend_Service">
<link rel="chapter" href="zend.session.html" title="第 49 章 Zend_Session">
<link rel="chapter" href="zend.soap.html" title="第 50 章 Zend_Soap">
<link rel="chapter" href="zend.tag.html" title="第 51 章 Zend_Tag">
<link rel="chapter" href="zend.test.html" title="第 52 章 Zend_Test">
<link rel="chapter" href="zend.text.html" title="第 53 章 Zend_Text">
<link rel="chapter" href="zend.timesync.html" title="第 54 章 Zend_TimeSync">
<link rel="chapter" href="zend.tool.framework.html" title="第 55 章 Zend_Tool_Framework">
<link rel="chapter" href="zend.tool.project.html" title="第 56 章 Zend_Tool_Project">
<link rel="chapter" href="zend.translate.html" title="第 57 章 Zend_Translate">
<link rel="chapter" href="zend.uri.html" title="第 58 章 Zend_Uri">
<link rel="chapter" href="zend.validate.html" title="第 59 章 Zend_Validate">
<link rel="chapter" href="zend.version.html" title="第 60 章 Zend_Version">
<link rel="chapter" href="zend.view.html" title="第 61 章 Zend_View">
<link rel="chapter" href="zend.wildfire.html" title="第 62 章 Zend_Wildfire">
<link rel="chapter" href="zend.xmlrpc.html" title="第 63 章 Zend_XmlRpc">
<link rel="chapter" href="zendx.console.process.unix.html" title="第 64 章 ZendX_Console_Process_Unix">
<link rel="chapter" href="zendx.jquery.html" title="第 65 章 ZendX_JQuery">
<link rel="appendix" href="requirements.html" title="附录 A. 系统需求">
<link rel="appendix" href="coding-standard.html" title="附录 B. Zend Framework 的 PHP 编码标准">
<link rel="appendix" href="doc-standard.html" title="附录 C. Zend Framework Documentation Standard">
<link rel="appendix" href="project-structure.html" title="附录 D. Recommended Project Structure for Zend Framework MVC Applications">
<link rel="appendix" href="performance.html" title="附录 E. Zend Framework Performance Guide">
<link rel="appendix" href="copyrights.html" title="附录 F. 版权信息">
<link rel="index" href="the.index.html" title="索引">
<link rel="subsection" href="zend.loader.pluginloader.html#zend.loader.pluginloader.usage" title="30.4.1.  基本用例">
<link rel="subsection" href="zend.loader.pluginloader.html#zend.loader.pluginloader.paths" title="30.4.2.  处理插件路径">
<link rel="subsection" href="zend.loader.pluginloader.html#zend.loader.pluginloader.checks" title="30.4.3.  测试插件和获取类的名字">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader"><table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">30.4.  加载插件 </th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="zend.loader.autoloader-resource.html">上一页</a> </td>
<th width="60%" align="center">第 30 章 Zend_Loader</th>
<td width="20%" align="right"> <a accesskey="n" href="zend.locale.html">下一页</a>
</td>
</tr>
</table></div>
<div class="sect1" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="zend.loader.pluginloader"></a>30.4.  加载插件 </h2></div></div></div>
<p>
        很多 Zend Framework 组件支持插件，允许通过指定类的前缀和到类的文件（不需要在 <code class="code">include_path</code> 或不需要遵循传统命名约定的文件）的路径动态加载函数。<code class="code">Zend_Loader_PluginLoader</code> 提供了普通的函数来完成这个工作。
    </p>
<p>
        <code class="code">PluginLoader</code> 的基本用法遵循 Zend Framework 的命名约定（一个文件一个类），解析路径时，使用下划线作为路径分隔符。当决定是否加载特别的插件类，允许传递可选的类前缀来预处理。另外，路径按 LIFO 顺序来搜索。由于 LIFO 搜索和类的前缀，允许命名空间给插件，这样可以从早期注册的路径来覆盖插件。
    </p>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.loader.pluginloader.usage"></a>30.4.1.  基本用例 </h3></div></div></div>
<p>
            首先，假定下面的目录结构和类文件，并且根（toplevel）目录和库目录在 include_path 中：
        </p>
<pre class="programlisting">
application/
    modules/
        foo/
            views/
                helpers/
                    FormLabel.php
                    FormSubmit.php
        bar/
            views/
                helpers/
                    FormSubmit.php
library/
    Zend/
        View/
            Helper/
                FormLabel.php
                FormSubmit.php
                FormText.php
</pre>
<p>
            现在，创建一个插件加载器来使各种各样的视图助手仓库可用：
        </p>
<pre class="programlisting">&lt;?php
$loader = new Zend_Loader_PluginLoader();
$loader-&gt;addPrefixPath('Zend_View_Helper', 'Zend/View/Helper/')
       -&gt;addPrefixPath('Foo_View_Helper', 'application/modules/foo/views/helpers')
       -&gt;addPrefixPath('Bar_View_Helper', 'application/modules/bar/views/helpers');
?&gt;</pre>
<p>
            接着用类名中添加路径时定义的前缀后面的部分来加载一个给定的视图助手：
        </p>
<pre class="programlisting">&lt;?php
// load 'FormText' helper:
$formTextClass = $loader-&gt;load('FormText'); // 'Zend_View_Helper_FormText';

// load 'FormLabel' helper:
$formLabelClass = $loader-&gt;load('FormLabel'); // 'Foo_View_Helper_FormLabel'

// load 'FormSubmit' helper:
$formSubmitClass = $loader-&gt;load('FormSubmit'); // 'Bar_View_Helper_FormSubmit'
?&gt;</pre>
<p>
            类加载后，就可以实例化了。
        </p>
<div class="note"><table border="0" summary="Note:  为一个前缀注册多个路径 ">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[注意]" src="images/note.png"></td>
<th align="left"> 为一个前缀注册多个路径 </th>
</tr>
<tr><td align="left" valign="top"><p>
                有时候，多个路径使用相同的前缀，<code class="code">Zend_Loader_PluginLoader</code> 实际上为每个给定的前缀注册一个路径数组；最后注册的被首先检查，当你使用孵化器里的组件时，这相当有用。
            </p></td></tr>
</table></div>
<div class="note"><table border="0" summary="Note:  实例化时定义路径 ">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[注意]" src="images/note.png"></td>
<th align="left"> 实例化时定义路径 </th>
</tr>
<tr><td align="left" valign="top">
<p>
                你可以提供给构造器一个可选的“前缀/路径”对（或“前缀/多个路径”）数组参数：
            </p>
<pre class="programlisting">&lt;?php
$loader = new Zend_Loader_PluginLoader(array(
    'Zend_View_Helper' =&gt; 'Zend/View/Helper/',
    'Foo_View_Helper'  =&gt; 'application/modules/foo/views/helpers',
    'Bar_View_Helper'  =&gt; 'application/modules/bar/views/helpers'
));
?&gt;</pre>
</td></tr>
</table></div>
<p>
            <code class="code">Zend_Loader_PluginLoader</code> 在不需要使用单态实例的情况下，也可选地允许共享插件，这是通过静态注册表来完成的，在实例化时需要注册表名作为构造器的第二个参数：

        </p>
<pre class="programlisting">&lt;?php
// Store plugins in static registry 'foobar':
$loader = new Zend_Loader_PluginLoader(array(), 'foobar');
?&gt;</pre>
<p>
            其它使用同名注册表来实例化 <code class="code">PluginLoader</code> 的组件将可以访问已经加载的路径和插件。
        </p>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.loader.pluginloader.paths"></a>30.4.2.  处理插件路径 </h3></div></div></div>
<p>
            上节的例子示例如何给插件加载器添加路径，那么如何确定已经加载的路径或删除他们呢？
        </p>
<div class="itemizedlist"><ul type="disc">
<li><p>
                    如果没有提供 <code class="code">$prefix</code>，<code class="code">getPaths($prefix = null)</code> 以“前缀/路径”对返回所有的路径；或者如果提供了 <code class="code">$prefix</code>，<code class="code">getPaths($prefix = null)</code> 返回为给定的前缀注册的路径。
            </p></li>
<li><p>
                    <code class="code">clearPaths($prefix = null)</code> 将缺省地清除所有的已注册路径，或者如果提供了 <code class="code">$prefix</code> 并放在堆栈里，只清除和那些和给定前缀关联的路径。
            </p></li>
<li><p>
                    <code class="code">removePrefixPath($prefix, $path = null)</code> 允许有选择地清除和给定前缀相关的特定的路径。如果没有提供 <code class="code">$path</code> ，所有的和前缀相关的路径被清除，如果提供了 <code class="code">$path</code> 并且相应的前缀存在，只有这个相关的路径被清除。
            </p></li>
</ul></div>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.loader.pluginloader.checks"></a>30.4.3.  测试插件和获取类的名字 </h3></div></div></div>
<p>
            有时候你想确定在执行一个动作之前是否插件类已经加载，<code class="code">isLoaded()</code> 返回插件名的状态。
        </p>
<p>
            <code class="code">PluginLoader</code> 的另一个普通用例是确定已加载类的完全合格的插件类名，<code class="code">getClassName()</code> 提供该功能。一般地，这个和 <code class="code">isLoaded()</code> 联合使用：
        </p>
<pre class="programlisting">&lt;?php
if ($loader-&gt;isLoaded('Adapter')) {
    $class   = $loader-&gt;getClassName('Adapter');
    $adapter = call_user_func(array($class, 'getInstance'));
}
?&gt;</pre>
</div>
</div>
<div class="navfooter"><table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="zend.loader.autoloader-resource.html">上一页</a> </td>
<td width="20%" align="center"><a accesskey="u" href="zend.loader.html">上一级</a></td>
<td width="40%" align="right"> <a accesskey="n" href="zend.locale.html">下一页</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">30.3. Resource Autoloaders </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td>
<td width="40%" align="right" valign="top"> 第 31 章 Zend_Locale</td>
</tr>
</table></div>
<div class="revinfo"></div>
</body>
</html>
