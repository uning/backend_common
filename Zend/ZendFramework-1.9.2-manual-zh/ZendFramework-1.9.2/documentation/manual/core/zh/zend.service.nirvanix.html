<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>48.20. Zend_Service_Nirvanix</title>
<link rel="stylesheet" href="dbstyle.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.72.0">
<link rel="start" href="index.html" title="Zend Framework手册 中文版">
<link rel="up" href="zend.service.html" title="第 48 章 Zend_Service">
<link rel="prev" href="zend.service.flickr.html" title="48.19. Zend_Service_Flickr">
<link rel="next" href="zend.service.recaptcha.html" title="48.21. Zend_Service_ReCaptcha">
<link rel="chapter" href="introduction.html" title="第 1 章 Zend Framework简介">
<link rel="chapter" href="zend.acl.html" title="第 2 章 Zend_Acl">
<link rel="chapter" href="zend.amf.html" title="第 3 章 Zend_Amf">
<link rel="chapter" href="zend.application.html" title="第 4 章 Zend_Application">
<link rel="chapter" href="zend.auth.html" title="第 5 章 Zend_Auth">
<link rel="chapter" href="zend.cache.html" title="第 6 章 Zend_Cache">
<link rel="chapter" href="zend.captcha.html" title="第 7 章 Zend_Captcha">
<link rel="chapter" href="zend.codegenerator.html" title="第 8 章 Zend_CodeGenerator">
<link rel="chapter" href="zend.config.html" title="第 9 章 Zend_Config">
<link rel="chapter" href="zend.config.writer.html" title="第 10 章 Zend_Config_Writer">
<link rel="chapter" href="zend.console.getopt.html" title="第 11 章 Zend_Console_Getopt">
<link rel="chapter" href="zend.controller.html" title="第 12 章 Zend_Controller">
<link rel="chapter" href="zend.currency.html" title="第 13 章 Zend_Currency">
<link rel="chapter" href="zend.date.html" title="第 14 章 Zend_Date">
<link rel="chapter" href="zend.db.html" title="第 15 章 Zend_Db">
<link rel="chapter" href="zend.debug.html" title="第 16 章 Zend_Debug">
<link rel="chapter" href="zend.dojo.html" title="第 17 章 Zend_Dojo">
<link rel="chapter" href="zend.dom.html" title="第 18 章 Zend_Dom">
<link rel="chapter" href="zend.exception.html" title="第 19 章 Zend_Exception">
<link rel="chapter" href="zend.feed.html" title="第 20 章 Zend_Feed">
<link rel="chapter" href="zend.file.html" title="第 21 章 Zend_File">
<link rel="chapter" href="zend.filter.html" title="第 22 章 Zend_Filter">
<link rel="chapter" href="zend.form.html" title="第 23 章 Zend_Form">
<link rel="chapter" href="zend.gdata.html" title="第 24 章 Zend_Gdata">
<link rel="chapter" href="zend.http.html" title="第 25 章 Zend_Http">
<link rel="chapter" href="zend.infocard.html" title="第 26 章 Zend_InfoCard">
<link rel="chapter" href="zend.json.html" title="第 27 章 Zend_Json">
<link rel="chapter" href="zend.layout.html" title="第 28 章 Zend_Layout">
<link rel="chapter" href="zend.ldap.html" title="第 29 章 Zend_Ldap">
<link rel="chapter" href="zend.loader.html" title="第 30 章 Zend_Loader">
<link rel="chapter" href="zend.locale.html" title="第 31 章 Zend_Locale">
<link rel="chapter" href="zend.log.html" title="第 32 章 Zend_Log">
<link rel="chapter" href="zend.mail.html" title="第 33 章 Zend_Mail">
<link rel="chapter" href="zend.measure.html" title="第 34 章 Zend_Measure">
<link rel="chapter" href="zend.memory.html" title="第 35 章 Zend_Memory">
<link rel="chapter" href="zend.mime.html" title="第 36 章 Zend_Mime">
<link rel="chapter" href="zend.navigation.html" title="第 37 章 Zend_Navigation">
<link rel="chapter" href="zend.openid.html" title="第 38 章 Zend_OpenId">
<link rel="chapter" href="zend.paginator.html" title="第 39 章 Zend_Paginator">
<link rel="chapter" href="zend.pdf.html" title="第 40 章 Zend_Pdf">
<link rel="chapter" href="zend.progressbar.html" title="第 41 章 Zend_ProgressBar">
<link rel="chapter" href="zend.queue.html" title="第 42 章 Zend_Queue">
<link rel="chapter" href="zend.reflection.html" title="第 43 章 Zend_Reflection">
<link rel="chapter" href="zend.registry.html" title="第 44 章 Zend_Registry">
<link rel="chapter" href="zend.rest.html" title="第 45 章 Zend_Rest">
<link rel="chapter" href="zend.search.lucene.html" title="第 46 章 Zend_Search_Lucene">
<link rel="chapter" href="zend.server.html" title="第 47 章 Zend_Server">
<link rel="chapter" href="zend.service.html" title="第 48 章 Zend_Service">
<link rel="chapter" href="zend.session.html" title="第 49 章 Zend_Session">
<link rel="chapter" href="zend.soap.html" title="第 50 章 Zend_Soap">
<link rel="chapter" href="zend.tag.html" title="第 51 章 Zend_Tag">
<link rel="chapter" href="zend.test.html" title="第 52 章 Zend_Test">
<link rel="chapter" href="zend.text.html" title="第 53 章 Zend_Text">
<link rel="chapter" href="zend.timesync.html" title="第 54 章 Zend_TimeSync">
<link rel="chapter" href="zend.tool.framework.html" title="第 55 章 Zend_Tool_Framework">
<link rel="chapter" href="zend.tool.project.html" title="第 56 章 Zend_Tool_Project">
<link rel="chapter" href="zend.translate.html" title="第 57 章 Zend_Translate">
<link rel="chapter" href="zend.uri.html" title="第 58 章 Zend_Uri">
<link rel="chapter" href="zend.validate.html" title="第 59 章 Zend_Validate">
<link rel="chapter" href="zend.version.html" title="第 60 章 Zend_Version">
<link rel="chapter" href="zend.view.html" title="第 61 章 Zend_View">
<link rel="chapter" href="zend.wildfire.html" title="第 62 章 Zend_Wildfire">
<link rel="chapter" href="zend.xmlrpc.html" title="第 63 章 Zend_XmlRpc">
<link rel="chapter" href="zendx.console.process.unix.html" title="第 64 章 ZendX_Console_Process_Unix">
<link rel="chapter" href="zendx.jquery.html" title="第 65 章 ZendX_JQuery">
<link rel="appendix" href="requirements.html" title="附录 A. 系统需求">
<link rel="appendix" href="coding-standard.html" title="附录 B. Zend Framework 的 PHP 编码标准">
<link rel="appendix" href="doc-standard.html" title="附录 C. Zend Framework Documentation Standard">
<link rel="appendix" href="project-structure.html" title="附录 D. Recommended Project Structure for Zend Framework MVC Applications">
<link rel="appendix" href="performance.html" title="附录 E. Zend Framework Performance Guide">
<link rel="appendix" href="copyrights.html" title="附录 F. 版权信息">
<link rel="index" href="the.index.html" title="索引">
<link rel="subsection" href="zend.service.nirvanix.html#zend.service.nirvanix.introduction" title="48.20.1. Introduction">
<link rel="subsection" href="zend.service.nirvanix.html#zend.service.nirvanix.registering" title="48.20.2. Registering with Nirvanix">
<link rel="subsection" href="zend.service.nirvanix.html#zend.service.nirvanix.apiDocumentation" title="48.20.3. API Documentation">
<link rel="subsection" href="zend.service.nirvanix.html#zend.service.nirvanix.features" title="48.20.4. Features">
<link rel="subsection" href="zend.service.nirvanix.html#zend.service.nirvanix.storing-your-first" title="48.20.5. Getting Started">
<link rel="subsection" href="zend.service.nirvanix.html#zend.service.nirvanix.understanding-proxy" title="48.20.6. Understanding the Proxy">
<link rel="subsection" href="zend.service.nirvanix.html#zend.service.nirvanix.examining-results" title="48.20.7. Examining Results">
<link rel="subsection" href="zend.service.nirvanix.html#zend.service.nirvanix.handling-errors" title="48.20.8. Handling Errors">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader"><table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">48.20. Zend_Service_Nirvanix</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="zend.service.flickr.html">上一页</a> </td>
<th width="60%" align="center">第 48 章 Zend_Service</th>
<td width="20%" align="right"> <a accesskey="n" href="zend.service.recaptcha.html">下一页</a>
</td>
</tr>
</table></div>
<div class="sect1" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="zend.service.nirvanix"></a>48.20. Zend_Service_Nirvanix</h2></div></div></div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.service.nirvanix.introduction"></a>48.20.1. Introduction</h3></div></div></div>
<p>
            Nirvanix provides an Internet Media File System (IMFS), an
            Internet storage service that allows applications to upload, store and
            organize files and subsequently access them using a standard Web
            Services interface. An IMFS is distributed clustered file system,
            accessed over the Internet, and optimized for dealing with media files
            (audio, video, etc). The goal of an IMFS is to provide massive
            scalability to deal with the challenges of media storage growth, with
            guaranteed access and availability regardless of time and location.
            Finally, an IMFS gives applications the ability to access data
            securely, without the large fixed costs associated with acquiring and
            maintaining physical storage assets.
        </p>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.service.nirvanix.registering"></a>48.20.2. Registering with Nirvanix</h3></div></div></div>
<p>
            Before you can get started with <code class="classname">Zend_Service_Nirvanix</code>, you must first
            register for an account. Please see the
            <a href="http://www.nirvanix.com/gettingStarted.aspx" target="_top">Getting Started</a>
            page on the Nirvanix website for more information.
        </p>
<p>
            After registering, you will receive a Username, Password, and
            Application Key. All three are required to use <code class="classname">Zend_Service_Nirvanix</code>.
        </p>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.service.nirvanix.apiDocumentation"></a>48.20.3. API Documentation</h3></div></div></div>
<p>
            Access to the Nirvanix IMFS is available through both <acronym class="acronym">SOAP</acronym> and a faster
            REST service. <code class="classname">Zend_Service_Nirvanix</code> provides a
            relatively thin <acronym class="acronym">PHP</acronym> 5 wrapper around the REST service.
        </p>
<p>
            <code class="classname">Zend_Service_Nirvanix</code> aims to make using the Nirvanix REST service
            easier but understanding the service itself is still essential to be successful
            with Nirvanix.
        </p>
<p>
            The <a href="http://developer.nirvanix.com/sitefiles/1000/API.html" target="_top">Nirvanix <acronym class="acronym">API</acronym> Documentation</a>
            provides an overview as well as detailed information using the
            service. Please familiarize yourself with this document and refer back to it
            as you use <code class="classname">Zend_Service_Nirvanix</code>.
        </p>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.service.nirvanix.features"></a>48.20.4. Features</h3></div></div></div>
<p>
            Nirvanix's REST service can be used effectively with <acronym class="acronym">PHP</acronym> using the
            <a href="http://www.php.net/simplexml" target="_top">SimpleXML</a>
            extension and <code class="classname">Zend_Http_Client</code> alone. However, using it this way
            is somewhat inconvenient due to repetitive operations like passing the
            session token on every request and repeatedly checking the response body for
            error codes.
        </p>
<p>
            <code class="classname">Zend_Service_Nirvanix</code> provides the following functionality:

            </p>
<div class="itemizedlist"><ul type="disc">
<li><p>
                        A single point for configuring your Nirvanix authentication
                        credentials that can be used across the Nirvanix namespaces.
                    </p></li>
<li><p>
                        A proxy object that is more convenient to use than an <acronym class="acronym">HTTP</acronym> client
                        alone, mostly removing the need to manually construct <acronym class="acronym">HTTP</acronym> POST
                        requests to access the REST service.
                    </p></li>
<li><p>
                        A response wrapper that parses each response body and throws an
                        exception if an error occurred, alleviating the need to repeatedly
                        check the success of many commands.
                    </p></li>
<li><p>
                        Additional convenience methods for some of the more common operations.
                    </p></li>
</ul></div>
<p>
        </p>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.service.nirvanix.storing-your-first"></a>48.20.5. Getting Started</h3></div></div></div>
<p>
            Once you have registered with Nirvanix, you're ready to store your first
            file on the IMFS. The most common operations that you will need to do
            on the IMFS are creating a new file, downloading an existing file, and
            deleting a file. <code class="classname">Zend_Service_Nirvanix</code> provides convenience
            methods for these three operations.
        </p>
<pre class="programlisting">
$auth = array('username' =&gt; 'your-username',
              'password' =&gt; 'your-password',
              'appKey'   =&gt; 'your-app-key');

$nirvanix = new Zend_Service_Nirvanix($auth);
$imfs = $nirvanix-&gt;getService('IMFS');

$imfs-&gt;putContents('/foo.txt', 'contents to store');

echo $imfs-&gt;getContents('/foo.txt');

$imfs-&gt;unlink('/foo.txt');
</pre>
<p>
            The first step to using <code class="classname">Zend_Service_Nirvanix</code> is always
            to authenticate against the service. This is done by passing your
            credentials to the <code class="classname">Zend_Service_Nirvanix</code> constructor
            above. The associative array is passed directly to Nirvanix as POST
            parameters.
        </p>
<p>
            Nirvanix divides its web services into
            <a href="http://developer.nirvanix.com/sitefiles/1000/API.html#_Toc175999879" target="_top">namespaces</a>.
            Each namespace encapsulates a group of related operations. After getting
            an instance of <code class="classname">Zend_Service_Nirvanix</code>, call the
            <code class="methodname">getService()</code> method to create a proxy for the namespace
            you want to use. Above, a proxy for the <code class="constant">IMFS</code> namespace is created.
        </p>
<p>
            After you have a proxy for the namespace you want to use, call methods on it.
            The proxy will allow you to use any command available on the REST <acronym class="acronym">API</acronym>. The
            proxy may also make convenience methods available, which wrap web service
            commands. The example above shows using the IMFS convenience methods to create a
            new file, retrieve and display that file, and finally delete the file.
        </p>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.service.nirvanix.understanding-proxy"></a>48.20.6. Understanding the Proxy</h3></div></div></div>
<p>
            In the previous example, we used the <code class="methodname">getService()</code> method to return
            a proxy object to the <code class="constant">IMFS</code> namespace. The proxy object allows
            you to use the Nirvanix REST service in a way that's closer to making a normal
            <acronym class="acronym">PHP</acronym> method call, as opposed to constructing your own <acronym class="acronym">HTTP</acronym> request objects.
        </p>
<p>
            A proxy object may provide convenience methods. These are methods that the
            <code class="classname">Zend_Service_Nirvanix</code> provides to simplify the use of
            the Nirvanix web services. In the previous example, the methods
            <code class="methodname">putContents()</code>, <code class="methodname">getContents()</code>, and <code class="methodname">unlink()</code>
            do not have direct equivalents in the REST <acronym class="acronym">API</acronym>. They are convenience methods
            provided by <code class="classname">Zend_Service_Nirvanix</code> that abstract more complicated
            operations on the REST <acronym class="acronym">API</acronym>.
        </p>
<p>
            For all other method calls to the proxy object, the proxy will dynamically
            convert the method call to the equivalent <acronym class="acronym">HTTP</acronym> POST request to the REST <acronym class="acronym">API</acronym>.
            It does this by using the method name as the <acronym class="acronym">API</acronym> command, and an associative
            array in the first argument as the POST parameters.
        </p>
<p>
            Let's say you want to call the REST <acronym class="acronym">API</acronym> method
            <a href="http://developer.nirvanix.com/sitefiles/1000/API.html#_Toc175999923" target="_top">RenameFile</a>,
            which does not have a convenience method in <code class="classname">Zend_Service_Nirvanix</code>:
        </p>
<pre class="programlisting">
$auth = array('username' =&gt; 'your-username',
              'password' =&gt; 'your-password',
              'appKey'   =&gt; 'your-app-key');

$nirvanix = new Zend_Service_Nirvanix($auth);
$imfs = $nirvanix-&gt;getService('IMFS');

$result = $imfs-&gt;renameFile(array('filePath' =&gt; '/path/to/foo.txt',
                                  'newFileName' =&gt; 'bar.txt'));
</pre>
<p>
            Above, a proxy for the <code class="constant">IMFS</code> namespace is created. A method,
            <code class="methodname">renameFile()</code>, is then called on the proxy. This method does not
            exist as a convenience method in the <acronym class="acronym">PHP</acronym> code, so it is trapped by
            <code class="methodname">__call()</code> and converted into a POST request to the REST <acronym class="acronym">API</acronym> where
            the associative array is used as the POST parameters.
        </p>
<p>
            Notice in the Nirvanix <acronym class="acronym">API</acronym> documentation that <code class="code">sessionToken</code> is required
            for this method but we did not give it to the proxy object. It is added
            automatically for your convenience.
        </p>
<p>
            The result of this operation will either be a <code class="classname">Zend_Service_Nirvanix_Response</code>
            object wrapping the <acronym class="acronym">XML</acronym> returned by Nirvanix, or a <code class="classname">Zend_Service_Nirvanix_Exception</code>
            if an error occurred.
        </p>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.service.nirvanix.examining-results"></a>48.20.7. Examining Results</h3></div></div></div>
<p>
            The Nirvanix REST <acronym class="acronym">API</acronym> always returns its results in <acronym class="acronym">XML</acronym>. <code class="classname">Zend_Service_Nirvanix</code>
            parses this <acronym class="acronym">XML</acronym> with the <code class="code">SimpleXML</code> extension and then decorates
            the resulting <code class="code">SimpleXMLElement</code> with a <code class="classname">Zend_Service_Nirvanix_Response</code>
            object.
        </p>
<p>
            The simplest way to examine a result from the service is to use the
            built-in <acronym class="acronym">PHP</acronym> functions like <code class="methodname">print_r()</code>:
        </p>
<pre class="programlisting">
&lt;?php
$auth = array('username' =&gt; 'your-username',
              'password' =&gt; 'your-password',
              'appKey'   =&gt; 'your-app-key');

$nirvanix = new Zend_Service_Nirvanix($auth);
$imfs = $nirvanix-&gt;getService('IMFS');

$result = $imfs-&gt;putContents('/foo.txt', 'fourteen bytes');
print_r($result);
?&gt;

Zend_Service_Nirvanix_Response Object
(
    [_sxml:protected] =&gt; SimpleXMLElement Object
        (
            [ResponseCode] =&gt; 0
            [FilesUploaded] =&gt; 1
            [BytesUploaded] =&gt; 14
        )
)
</pre>
<p>
            You can access any property or method of the decorated <code class="code">SimpleXMLElement</code>.
            In the above example, <code class="code">$result-&gt;BytesUploaded</code> could be used to see the
            number of bytes received. Should you want to access the <code class="code">SimpleXMLElement</code>
            directly, just use <code class="code">$result-&gt;getSxml()</code>.
        </p>
<p>
            The most common response from Nirvanix is success (<code class="code">ResponseCode</code> of zero).
            It is not normally necessary to check <code class="code">ResponseCode</code> because any non-zero
            result will throw a <code class="classname">Zend_Service_Nirvanix_Exception</code>. See the next
            section on handling errors.
        </p>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.service.nirvanix.handling-errors"></a>48.20.8. Handling Errors</h3></div></div></div>
<p>
            When using Nirvanix, it's important to anticipate errors that can be returned
            by the service and handle them appropriately.
        </p>
<p>
            All operations against the REST service result in an <acronym class="acronym">XML</acronym> return payload that
            contains a <code class="code">ResponseCode</code> element, such as the following example:
        </p>
<pre class="programlisting">
&lt;Response&gt;
   &lt;ResponseCode&gt;0&lt;/ResponseCode&gt;
&lt;/Response&gt;
</pre>
<p>
            When the <code class="code">ResponseCode</code> is zero such as in the example
            above, the operation was successful. When the operation is not
            successful, the <code class="code">ResponseCode</code> is non-zero and an
            <code class="code">ErrorMessage</code> element should be present.
        </p>
<p>
            To alleviate the need to repeatedly check if the <code class="code">ResponseCode</code>
            is non-zero, <code class="classname">Zend_Service_Nirvanix</code> automatically checks each response
            returned by Nirvanix. If the <code class="code">ResponseCode</code> indicates an
            error, a <code class="classname">Zend_Service_Nirvanix_Exception</code> will be thrown.
        </p>
<pre class="programlisting">
$auth = array('username' =&gt; 'your-username',
              'password' =&gt; 'your-password',
              'appKey'   =&gt; 'your-app-key');
$nirvanix = new Zend_Service_Nirvanix($auth);

try {

  $imfs = $nirvanix-&gt;getService('IMFS');
  $imfs-&gt;unlink('/a-nonexistant-path');

} catch (Zend_Service_Nirvanix_Exception $e) {
  echo $e-&gt;getMessage() . "\n";
  echo $e-&gt;getCode();
}
</pre>
<p>
            In the example above, <code class="methodname">unlink()</code> is a convenience method that wraps the
            <code class="code">DeleteFiles</code> command on the REST <acronym class="acronym">API</acronym>. The <code class="code">filePath</code> parameter required by the
            <a href="http://developer.nirvanix.com/sitefiles/1000/API.html#_Toc175999918" target="_top">DeleteFiles</a>
            command contains a path that does not exist. This will result in a
            <code class="classname">Zend_Service_Nirvanix</code> exception being thrown with the message
            "Invalid path" and code 70005.
        </p>
<p>
            The <a href="http://developer.nirvanix.com/sitefiles/1000/API.html" target="_top">Nirvanix
            <acronym class="acronym">API</acronym> Documentation</a> describes the errors associated with each command. Depending
            on your needs, you may wrap each command in a <code class="code">try</code> block or
            wrap many commands in the same <code class="code">try</code> block for convenience.
        </p>
</div>
</div>
<div class="navfooter"><table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="zend.service.flickr.html">上一页</a> </td>
<td width="20%" align="center"><a accesskey="u" href="zend.service.html">上一级</a></td>
<td width="40%" align="right"> <a accesskey="n" href="zend.service.recaptcha.html">下一页</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">48.19. Zend_Service_Flickr </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td>
<td width="40%" align="right" valign="top"> 48.21. Zend_Service_ReCaptcha</td>
</tr>
</table></div>
<div class="revinfo"></div>
</body>
</html>
