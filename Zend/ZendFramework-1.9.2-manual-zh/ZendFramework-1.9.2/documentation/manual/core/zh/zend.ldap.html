<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>第 29 章 Zend_Ldap</title>
<link rel="stylesheet" href="dbstyle.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.72.0">
<link rel="start" href="index.html" title="Zend Framework手册 中文版">
<link rel="up" href="index.html" title="Zend Framework手册 中文版">
<link rel="prev" href="zend.layout.advanced.html" title="28.4. Zend_Layout 高级用法">
<link rel="next" href="zend.ldap.api.html" title="29.2. API overview">
<link rel="chapter" href="introduction.html" title="第 1 章 Zend Framework简介">
<link rel="chapter" href="zend.acl.html" title="第 2 章 Zend_Acl">
<link rel="chapter" href="zend.amf.html" title="第 3 章 Zend_Amf">
<link rel="chapter" href="zend.application.html" title="第 4 章 Zend_Application">
<link rel="chapter" href="zend.auth.html" title="第 5 章 Zend_Auth">
<link rel="chapter" href="zend.cache.html" title="第 6 章 Zend_Cache">
<link rel="chapter" href="zend.captcha.html" title="第 7 章 Zend_Captcha">
<link rel="chapter" href="zend.codegenerator.html" title="第 8 章 Zend_CodeGenerator">
<link rel="chapter" href="zend.config.html" title="第 9 章 Zend_Config">
<link rel="chapter" href="zend.config.writer.html" title="第 10 章 Zend_Config_Writer">
<link rel="chapter" href="zend.console.getopt.html" title="第 11 章 Zend_Console_Getopt">
<link rel="chapter" href="zend.controller.html" title="第 12 章 Zend_Controller">
<link rel="chapter" href="zend.currency.html" title="第 13 章 Zend_Currency">
<link rel="chapter" href="zend.date.html" title="第 14 章 Zend_Date">
<link rel="chapter" href="zend.db.html" title="第 15 章 Zend_Db">
<link rel="chapter" href="zend.debug.html" title="第 16 章 Zend_Debug">
<link rel="chapter" href="zend.dojo.html" title="第 17 章 Zend_Dojo">
<link rel="chapter" href="zend.dom.html" title="第 18 章 Zend_Dom">
<link rel="chapter" href="zend.exception.html" title="第 19 章 Zend_Exception">
<link rel="chapter" href="zend.feed.html" title="第 20 章 Zend_Feed">
<link rel="chapter" href="zend.file.html" title="第 21 章 Zend_File">
<link rel="chapter" href="zend.filter.html" title="第 22 章 Zend_Filter">
<link rel="chapter" href="zend.form.html" title="第 23 章 Zend_Form">
<link rel="chapter" href="zend.gdata.html" title="第 24 章 Zend_Gdata">
<link rel="chapter" href="zend.http.html" title="第 25 章 Zend_Http">
<link rel="chapter" href="zend.infocard.html" title="第 26 章 Zend_InfoCard">
<link rel="chapter" href="zend.json.html" title="第 27 章 Zend_Json">
<link rel="chapter" href="zend.layout.html" title="第 28 章 Zend_Layout">
<link rel="chapter" href="zend.ldap.html" title="第 29 章 Zend_Ldap">
<link rel="chapter" href="zend.loader.html" title="第 30 章 Zend_Loader">
<link rel="chapter" href="zend.locale.html" title="第 31 章 Zend_Locale">
<link rel="chapter" href="zend.log.html" title="第 32 章 Zend_Log">
<link rel="chapter" href="zend.mail.html" title="第 33 章 Zend_Mail">
<link rel="chapter" href="zend.measure.html" title="第 34 章 Zend_Measure">
<link rel="chapter" href="zend.memory.html" title="第 35 章 Zend_Memory">
<link rel="chapter" href="zend.mime.html" title="第 36 章 Zend_Mime">
<link rel="chapter" href="zend.navigation.html" title="第 37 章 Zend_Navigation">
<link rel="chapter" href="zend.openid.html" title="第 38 章 Zend_OpenId">
<link rel="chapter" href="zend.paginator.html" title="第 39 章 Zend_Paginator">
<link rel="chapter" href="zend.pdf.html" title="第 40 章 Zend_Pdf">
<link rel="chapter" href="zend.progressbar.html" title="第 41 章 Zend_ProgressBar">
<link rel="chapter" href="zend.queue.html" title="第 42 章 Zend_Queue">
<link rel="chapter" href="zend.reflection.html" title="第 43 章 Zend_Reflection">
<link rel="chapter" href="zend.registry.html" title="第 44 章 Zend_Registry">
<link rel="chapter" href="zend.rest.html" title="第 45 章 Zend_Rest">
<link rel="chapter" href="zend.search.lucene.html" title="第 46 章 Zend_Search_Lucene">
<link rel="chapter" href="zend.server.html" title="第 47 章 Zend_Server">
<link rel="chapter" href="zend.service.html" title="第 48 章 Zend_Service">
<link rel="chapter" href="zend.session.html" title="第 49 章 Zend_Session">
<link rel="chapter" href="zend.soap.html" title="第 50 章 Zend_Soap">
<link rel="chapter" href="zend.tag.html" title="第 51 章 Zend_Tag">
<link rel="chapter" href="zend.test.html" title="第 52 章 Zend_Test">
<link rel="chapter" href="zend.text.html" title="第 53 章 Zend_Text">
<link rel="chapter" href="zend.timesync.html" title="第 54 章 Zend_TimeSync">
<link rel="chapter" href="zend.tool.framework.html" title="第 55 章 Zend_Tool_Framework">
<link rel="chapter" href="zend.tool.project.html" title="第 56 章 Zend_Tool_Project">
<link rel="chapter" href="zend.translate.html" title="第 57 章 Zend_Translate">
<link rel="chapter" href="zend.uri.html" title="第 58 章 Zend_Uri">
<link rel="chapter" href="zend.validate.html" title="第 59 章 Zend_Validate">
<link rel="chapter" href="zend.version.html" title="第 60 章 Zend_Version">
<link rel="chapter" href="zend.view.html" title="第 61 章 Zend_View">
<link rel="chapter" href="zend.wildfire.html" title="第 62 章 Zend_Wildfire">
<link rel="chapter" href="zend.xmlrpc.html" title="第 63 章 Zend_XmlRpc">
<link rel="chapter" href="zendx.console.process.unix.html" title="第 64 章 ZendX_Console_Process_Unix">
<link rel="chapter" href="zendx.jquery.html" title="第 65 章 ZendX_JQuery">
<link rel="appendix" href="requirements.html" title="附录 A. 系统需求">
<link rel="appendix" href="coding-standard.html" title="附录 B. Zend Framework 的 PHP 编码标准">
<link rel="appendix" href="doc-standard.html" title="附录 C. Zend Framework Documentation Standard">
<link rel="appendix" href="project-structure.html" title="附录 D. Recommended Project Structure for Zend Framework MVC Applications">
<link rel="appendix" href="performance.html" title="附录 E. Zend Framework Performance Guide">
<link rel="appendix" href="copyrights.html" title="附录 F. 版权信息">
<link rel="index" href="the.index.html" title="索引">
<link rel="section" href="zend.ldap.html#zend.ldap.introduction" title="29.1. Introduction">
<link rel="section" href="zend.ldap.api.html" title="29.2. API overview">
<link rel="section" href="zend.ldap.usage.html" title="29.3. Usage Scenarios">
<link rel="section" href="zend.ldap.tools.html" title="29.4. Tools">
<link rel="section" href="zend.ldap.node.html" title="29.5. Object oriented access to the LDAP tree using Zend_Ldap_Node">
<link rel="section" href="zend.ldap.server.html" title="29.6. Getting information from the LDAP server">
<link rel="section" href="zend.ldap.ldif.html" title="29.7. Serializing LDAP data to and from LDIF">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader"><table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">第 29 章 Zend_Ldap</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="zend.layout.advanced.html">上一页</a> </td>
<th width="60%" align="center"> </th>
<td width="20%" align="right"> <a accesskey="n" href="zend.ldap.api.html">下一页</a>
</td>
</tr>
</table></div>
<div class="chapter" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title">
<a name="zend.ldap"></a>第 29 章 Zend_Ldap</h2></div></div></div>
<div class="toc">
<p><b>目录</b></p>
<dl>
<dt><span class="sect1"><a href="zend.ldap.html#zend.ldap.introduction">29.1. Introduction</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="zend.ldap.html#zend.ldap.introduction.theory-of-operations">29.1.1. Theory of operation</a></span></dt>
<dd><dl>
<dt><span class="sect3"><a href="zend.ldap.html#zend.ldap.introduction.theory-of-operations.automatic-username-canonicalization">29.1.1.1. Automatic Username Canonicalization When Binding</a></span></dt>
<dt><span class="sect3"><a href="zend.ldap.html#zend.ldap.introduction.theory-of-operations.account-name-canonicalization">29.1.1.2. Account Name Canonicalization</a></span></dt>
<dt><span class="sect3"><a href="zend.ldap.html#zend.ldap.introduction.theory-of-operations.multi-domain-failover">29.1.1.3. Multi-domain Authentication and Failover</a></span></dt>
</dl></dd>
</dl></dd>
<dt><span class="sect1"><a href="zend.ldap.api.html">29.2. API overview</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="zend.ldap.api.html#zend.ldap.api.configuration">29.2.1. Configuration / options</a></span></dt>
<dt><span class="sect2"><a href="zend.ldap.api.html#zend.ldap.api.reference">29.2.2. API Reference</a></span></dt>
<dd><dl>
<dt><span class="sect3"><a href="zend.ldap.api.html#zend.ldap.api.reference.zend-ldap">29.2.2.1. Zend_Ldap</a></span></dt>
<dd><dl><dt><span class="sect4"><a href="zend.ldap.api.html#zend.ldap.api.reference.zend-ldap.zend-ldap-collection">29.2.2.1.1. Zend_Ldap_Collection</a></span></dt></dl></dd>
<dt><span class="sect3"><a href="zend.ldap.api.html#zend.ldap.api.reference.zend-ldap-attribute">29.2.2.2. Zend_Ldap_Attribute</a></span></dt>
<dt><span class="sect3"><a href="zend.ldap.api.html#zend.ldap.api.reference.zend-ldap-dn">29.2.2.3. Zend_Ldap_Dn</a></span></dt>
<dt><span class="sect3"><a href="zend.ldap.api.html#zend.ldap.api.reference.zend-ldap-filter">29.2.2.4. Zend_Ldap_Filter</a></span></dt>
<dt><span class="sect3"><a href="zend.ldap.api.html#zend.ldap.api.reference.zend-ldap-node">29.2.2.5. Zend_Ldap_Node</a></span></dt>
<dt><span class="sect3"><a href="zend.ldap.api.html#zend.ldap.api.reference.zend-ldap-node-rootdse">29.2.2.6. Zend_Ldap_Node_RootDse</a></span></dt>
<dd><dl>
<dt><span class="sect4"><a href="zend.ldap.api.html#zend.ldap.api.reference.zend-ldap-node-rootdse.openldap">29.2.2.6.1. OpenLDAP</a></span></dt>
<dt><span class="sect4"><a href="zend.ldap.api.html#zend.ldap.api.reference.zend-ldap-node-rootdse.activedirectory">29.2.2.6.2. ActiveDirectory</a></span></dt>
<dt><span class="sect4"><a href="zend.ldap.api.html#zend.ldap.api.reference.zend-ldap-node-rootdse.edirectory">29.2.2.6.3. eDirectory</a></span></dt>
</dl></dd>
<dt><span class="sect3"><a href="zend.ldap.api.html#zend.ldap.api.reference.zend-ldap-node-schema">29.2.2.7. Zend_Ldap_Node_Schema</a></span></dt>
<dd><dl>
<dt><span class="sect4"><a href="zend.ldap.api.html#zend.ldap.api.reference.zend-ldap-node-schema.openldap">29.2.2.7.1. OpenLDAP</a></span></dt>
<dt><span class="sect4"><a href="zend.ldap.api.html#zend.ldap.api.reference.zend-ldap-node-schema.activedirectory">29.2.2.7.2. ActiveDirectory</a></span></dt>
</dl></dd>
<dt><span class="sect3"><a href="zend.ldap.api.html#zend.ldap.api.reference.zend-ldap-ldif-encoder">29.2.2.8. Zend_Ldif_Encoder</a></span></dt>
</dl></dd>
</dl></dd>
<dt><span class="sect1"><a href="zend.ldap.usage.html">29.3. Usage Scenarios</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="zend.ldap.usage.html#zend.ldap.usage.authentication">29.3.1. Authentication scenarios</a></span></dt>
<dd><dl>
<dt><span class="sect3"><a href="zend.ldap.usage.html#zend.ldap.usage.authentication.openldap">29.3.1.1. OpenLDAP</a></span></dt>
<dt><span class="sect3"><a href="zend.ldap.usage.html#zend.ldap.usage.authentication.activedirectory">29.3.1.2. ActiveDirectory</a></span></dt>
</dl></dd>
<dt><span class="sect2"><a href="zend.ldap.usage.html#zend.ldap.usage.basic">29.3.2. Basic CRUD operations</a></span></dt>
<dd><dl>
<dt><span class="sect3"><a href="zend.ldap.usage.html#zend.ldap.usage.basic.retrieve">29.3.2.1. Retrieving data from the LDAP</a></span></dt>
<dt><span class="sect3"><a href="zend.ldap.usage.html#zend.ldap.usage.basic.add">29.3.2.2. Adding data to the LDAP</a></span></dt>
<dt><span class="sect3"><a href="zend.ldap.usage.html#zend.ldap.usage.basic.delete">29.3.2.3. Deleting from the LDAP</a></span></dt>
<dt><span class="sect3"><a href="zend.ldap.usage.html#zend.ldap.usage.basic.update">29.3.2.4. Updating the LDAP</a></span></dt>
</dl></dd>
<dt><span class="sect2"><a href="zend.ldap.usage.html#zend.ldap.usage.extended">29.3.3. Extended operations</a></span></dt>
<dd><dl><dt><span class="sect3"><a href="zend.ldap.usage.html#zend.ldap.usage.extended.copy-and-move">29.3.3.1. Copy and move entries in the LDAP</a></span></dt></dl></dd>
</dl></dd>
<dt><span class="sect1"><a href="zend.ldap.tools.html">29.4. Tools</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="zend.ldap.tools.html#zend.ldap.tools.dn">29.4.1. Creation and modification of DN strings</a></span></dt>
<dt><span class="sect2"><a href="zend.ldap.tools.html#zend.ldap.tools.filter">29.4.2. Using the filter API to create search filters</a></span></dt>
<dt><span class="sect2"><a href="zend.ldap.tools.html#zend.ldap.tools.attribute">29.4.3. Modify LDAP entries using the Attribute API</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="zend.ldap.node.html">29.5. Object oriented access to the LDAP tree using Zend_Ldap_Node</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="zend.ldap.node.html#zend.ldap.node.basic">29.5.1. Basic CRUD operations</a></span></dt>
<dd><dl>
<dt><span class="sect3"><a href="zend.ldap.node.html#zend.ldap.node.basic.retrieve">29.5.1.1. Retrieving data from the LDAP</a></span></dt>
<dd><dl>
<dt><span class="sect4"><a href="zend.ldap.node.html#zend.ldap.node.basic.retrieve.dn">29.5.1.1.1. Getting a node by its DN</a></span></dt>
<dt><span class="sect4"><a href="zend.ldap.node.html#zend.ldap.node.basic.retrieve.search">29.5.1.1.2. Searching a node's subtree</a></span></dt>
</dl></dd>
<dt><span class="sect3"><a href="zend.ldap.node.html#zend.ldap.node.basic.add">29.5.1.2. Adding a new node to the LDAP</a></span></dt>
<dt><span class="sect3"><a href="zend.ldap.node.html#zend.ldap.node.basic.delete">29.5.1.3. Deleting a node from the LDAP</a></span></dt>
<dt><span class="sect3"><a href="zend.ldap.node.html#zend.ldap.node.basic.update">29.5.1.4. Updating a node on the LDAP</a></span></dt>
</dl></dd>
<dt><span class="sect2"><a href="zend.ldap.node.html#zend.ldap.node.extended">29.5.2. Extended operations</a></span></dt>
<dd><dl><dt><span class="sect3"><a href="zend.ldap.node.html#zend.ldap.node.extended.copy-and-move">29.5.2.1. Copy and move nodes in the LDAP</a></span></dt></dl></dd>
<dt><span class="sect2"><a href="zend.ldap.node.html#zend.ldap.node.traversal">29.5.3. Tree traversal</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="zend.ldap.server.html">29.6. Getting information from the LDAP server</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="zend.ldap.server.html#zend.ldap.server.rootdse">29.6.1. RootDSE</a></span></dt>
<dt><span class="sect2"><a href="zend.ldap.server.html#zend.ldap.server.schema">29.6.2. Schema Browsing</a></span></dt>
<dd><dl>
<dt><span class="sect3"><a href="zend.ldap.server.html#zend.ldap.server.schema.openldap">29.6.2.1. OpenLDAP</a></span></dt>
<dt><span class="sect3"><a href="zend.ldap.server.html#zend.ldap.server.schema.activedirectory">29.6.2.2. ActiveDirectory</a></span></dt>
</dl></dd>
</dl></dd>
<dt><span class="sect1"><a href="zend.ldap.ldif.html">29.7. Serializing LDAP data to and from LDIF</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="zend.ldap.ldif.html#zend.ldap.ldif.encode">29.7.1. Serialize a LDAP entry to LDIF</a></span></dt>
<dt><span class="sect2"><a href="zend.ldap.ldif.html#zend.ldap.ldif.decode">29.7.2. Deserialize a LDIF string into a LDAP entry</a></span></dt>
</dl></dd>
</dl>
</div>
<div class="sect1" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="zend.ldap.introduction"></a>29.1. Introduction</h2></div></div></div>
<p>
        <code class="classname">Zend_Ldap</code> is a class for performing <acronym class="acronym">LDAP</acronym>
        operations including but not limited to binding, searching and modifying entries
        in an <acronym class="acronym">LDAP</acronym> directory.
    </p>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.ldap.introduction.theory-of-operations"></a>29.1.1. Theory of operation</h3></div></div></div>
<p>
            This component currently consists of the main <code class="classname">Zend_Ldap</code> class,
            that conceptually represents a binding to a single <acronym class="acronym">LDAP</acronym> server
            and allows for executing operations against a <acronym class="acronym">LDAP</acronym> server such
            as OpenLDAP or ActiveDirectory (AD) servers. The parameters for binding may be
            provided explicitly or in the form of an options array.
            <code class="classname">Zend_Ldap_Node</code> provides an object-oriented interface
            for single <acronym class="acronym">LDAP</acronym> nodes and can be used to form a basis for an
            active-record-like interface for a <acronym class="acronym">LDAP</acronym>-based domain model.
        </p>
<p>
            The component provides several helper classes to perform operations on
            <acronym class="acronym">LDAP</acronym> entries (<code class="classname">Zend_Ldap_Attribute</code>) such as
            setting and retrieving attributes (date values, passwords, boolean values, ...), to
            create and modify <acronym class="acronym">LDAP</acronym> filter strings
            (<code class="classname">Zend_Ldap_Filter</code>) and to manipulate <acronym class="acronym">LDAP</acronym>
            distinguished names (DN) (<code class="classname">Zend_Ldap_Dn</code>).
        </p>
<p>
            Additionally the component abstracts <acronym class="acronym">LDAP</acronym> schema browsing
            for OpenLDAP and ActiveDirectoy servers <code class="classname">Zend_Ldap_Node_Schema</code>
            and server information retrieval for OpenLDAP-, ActiveDirectory- and Novell
            eDirectory servers (<code class="classname">Zend_Ldap_Node_RootDse</code>).
        </p>
<p>
            Using the <code class="classname">Zend_Ldap</code> class depends on the type of
            <acronym class="acronym">LDAP</acronym> server and is best summarized with some simple examples.
        </p>
<p>
            If you are using OpenLDAP, a simple example looks like the following
            (note that the <span class="emphasis"><em>bindRequiresDn</em></span> option is important if you are
            <span class="emphasis"><em>not</em></span> using AD):
        </p>
<pre class="programlisting">
$options = array(
    'host'              =&gt; 's0.foo.net',
    'username'          =&gt; 'CN=user1,DC=foo,DC=net',
    'password'          =&gt; 'pass1',
    'bindRequiresDn'    =&gt; true,
    'accountDomainName' =&gt; 'foo.net',
    'baseDn'            =&gt; 'OU=Sales,DC=foo,DC=net',
);
$ldap = new Zend_Ldap($options);
$acctname = $ldap-&gt;getCanonicalAccountName('abaker',
                                           Zend_Ldap::ACCTNAME_FORM_DN);
echo "$acctname\n";
</pre>
<p>
            If you are using Microsoft AD a simple example is:
        </p>
<pre class="programlisting">
$options = array(
    'host'                   =&gt; 'dc1.w.net',
    'useStartTls'            =&gt; true,
    'username'               =&gt; 'user1@w.net',
    'password'               =&gt; 'pass1',
    'accountDomainName'      =&gt; 'w.net',
    'accountDomainNameShort' =&gt; 'W',
    'baseDn'                 =&gt; 'CN=Users,DC=w,DC=net',
);
$ldap = new Zend_Ldap($options);
$acctname = $ldap-&gt;getCanonicalAccountName('bcarter',
                                           Zend_Ldap::ACCTNAME_FORM_DN);
echo "$acctname\n";
</pre>
<p>
            Note that we use the <code class="methodname">getCanonicalAccountName()</code> method
            to retrieve the account DN here only because that is what exercises the
            most of what little code is currently present in this class.
        </p>
<div class="sect3" lang="zh-cn">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.ldap.introduction.theory-of-operations.automatic-username-canonicalization"></a>29.1.1.1. Automatic Username Canonicalization When Binding</h4></div></div></div>
<p>
                If <code class="methodname">bind()</code> is called with a non-DN username but
                <span class="emphasis"><em>bindRequiresDN</em></span> is <code class="constant">TRUE</code> and no username in
                DN form was supplied as an option, the bind will fail. However, if a username in DN
                form is supplied in the options array, <code class="classname">Zend_Ldap</code> will
                first bind with that username, retrieve the account DN for the username
                supplied to <code class="methodname">bind()</code> and then re-bind with that DN.
            </p>
<p>
                This behavior is critical to <a href="zend.auth.adapter.ldap.html" title="5.5. LDAP 认证"><code class="classname">Zend_Auth_Adapter_Ldap</code></a>,
                which passes the username supplied by the user directly to
                <code class="methodname">bind()</code>.
            </p>
<p>
                The following example illustrates how the non-DN username
                '<span class="emphasis"><em>abaker</em></span>' can be used with <code class="methodname">bind()</code>:
            </p>
<pre class="programlisting">
$options = array(
        'host'              =&gt; 's0.foo.net',
        'username'          =&gt; 'CN=user1,DC=foo,DC=net',
        'password'          =&gt; 'pass1',
        'bindRequiresDn'    =&gt; true,
        'accountDomainName' =&gt; 'foo.net',
        'baseDn'            =&gt; 'OU=Sales,DC=foo,DC=net',
);
$ldap = new Zend_Ldap($options);
$ldap-&gt;bind('abaker', 'moonbike55');
$acctname = $ldap-&gt;getCanonicalAccountName('abaker',
                                           Zend_Ldap::ACCTNAME_FORM_DN);
echo "$acctname\n";
</pre>
<p>
                The <code class="methodname">bind()</code> call in this example sees that
                the username '<span class="emphasis"><em>abaker</em></span>' is not in DN form, finds
                <span class="emphasis"><em>bindRequiresDn</em></span> is <code class="constant">TRUE</code>, uses
                '<span><strong class="command">CN=user1,DC=foo,DC=net</strong></span>' and '<span class="emphasis"><em>pass1</em></span>' to
                bind, retrieves the DN for '<span class="emphasis"><em>abaker</em></span>', unbinds and then rebinds
                with the newly discovered
                '<span><strong class="command">CN=Alice Baker,OU=Sales,DC=foo,DC=net</strong></span>'.
            </p>
</div>
<div class="sect3" lang="zh-cn">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.ldap.introduction.theory-of-operations.account-name-canonicalization"></a>29.1.1.2. Account Name Canonicalization</h4></div></div></div>
<p>
                The <span class="emphasis"><em>accountDomainName</em></span> and
                <span class="emphasis"><em>accountDomainNameShort</em></span>
                options are used for two purposes: (1) they facilitate multi-domain
                authentication and failover capability, and (2) they are also used to
                canonicalize usernames. Specifically, names are canonicalized to the
                form specified by the <span class="emphasis"><em>accountCanonicalForm</em></span> option.
                This option may one of the following values:
            </p>
<div class="table">
<a name="zend.ldap.using.theory-of-operation.account-name-canonicalization.table"></a><p class="title"><b>表 29.1. Options for accountCanonicalForm</b></p>
<div class="table-contents"><table summary="Options for accountCanonicalForm" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead><tr>
<th>Name</th>
<th>Value</th>
<th>Example</th>
</tr></thead>
<tbody>
<tr>
<td>
                                <code class="constant">ACCTNAME_FORM_DN</code>
                            </td>
<td>1</td>
<td>CN=Alice Baker,CN=Users,DC=example,DC=com</td>
</tr>
<tr>
<td>
                                <code class="constant">ACCTNAME_FORM_USERNAME</code>
                            </td>
<td>2</td>
<td>abaker</td>
</tr>
<tr>
<td>
                                <code class="constant">ACCTNAME_FORM_BACKSLASH</code>
                            </td>
<td>3</td>
<td>EXAMPLE\abaker</td>
</tr>
<tr>
<td>
                                <code class="constant">ACCTNAME_FORM_PRINCIPAL</code>
                            </td>
<td>4</td>
<td><code class="filename">abaker@example.com</code></td>
</tr>
</tbody>
</table></div>
</div>
<br class="table-break"><p>
                The default canonicalization depends on what account domain name options
                were supplied. If <span class="emphasis"><em>accountDomainNameShort</em></span> was supplied, the
                default <span class="emphasis"><em>accountCanonicalForm</em></span> value is
                <code class="constant">ACCTNAME_FORM_BACKSLASH</code>. Otherwise, if
                <span class="emphasis"><em>accountDomainName</em></span> was supplied, the
                default is <code class="constant">ACCTNAME_FORM_PRINCIPAL</code>.
            </p>
<p>
                Account name canonicalization ensures that the string used to identify
                an account is consistent regardless of what was supplied to
                <code class="methodname">bind()</code>. For example, if the user supplies an account
                name of <code class="filename">abaker@example.com</code> or just
                <span class="emphasis"><em>abaker</em></span> and the <span class="emphasis"><em>accountCanonicalForm</em></span>
                is set to 3, the resulting canonicalized name would be
                <span class="emphasis"><em>EXAMPLE\abaker</em></span>.
            </p>
</div>
<div class="sect3" lang="zh-cn">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.ldap.introduction.theory-of-operations.multi-domain-failover"></a>29.1.1.3. Multi-domain Authentication and Failover</h4></div></div></div>
<p>
                The <code class="classname">Zend_Ldap</code> component by itself makes no attempt
                to authenticate with multiple servers. However, <code class="classname">Zend_Ldap</code>
                is specifically designed to handle this scenario gracefully. The
                required technique is to simply iterate over an array of arrays of serve
                 options and attempt to bind with each server. As described above
                 <code class="methodname">bind()</code> will automatically canonicalize each name, so
                it does not matter if the user passes <code class="filename">abaker@foo.net</code> or
                <span class="emphasis"><em>W\bcarter</em></span> or <span class="emphasis"><em>cdavis</em></span> - the
                <code class="methodname">bind()</code> method will only succeed if the credentials were
                successfully used in the bind.
            </p>
<p>
                Consider the following example that illustrates the technique required to
                implement multi-domain authentication and failover:
            </p>
<pre class="programlisting">
$acctname = 'W\\user2';
$password = 'pass2';

$multiOptions = array(
    'server1' =&gt; array(
        'host'                   =&gt; 's0.foo.net',
        'username'               =&gt; 'CN=user1,DC=foo,DC=net',
        'password'               =&gt; 'pass1',
        'bindRequiresDn'         =&gt; true,
        'accountDomainName'      =&gt; 'foo.net',
        'accountDomainNameShort' =&gt; 'FOO',
        'accountCanonicalForm'   =&gt; 4, // ACCT_FORM_PRINCIPAL
        'baseDn'                 =&gt; 'OU=Sales,DC=foo,DC=net',
    ),
    'server2' =&gt; array(
        'host'                   =&gt; 'dc1.w.net',
        'useSsl'                 =&gt; true,
        'username'               =&gt; 'user1@w.net',
        'password'               =&gt; 'pass1',
        'accountDomainName'      =&gt; 'w.net',
        'accountDomainNameShort' =&gt; 'W',
        'accountCanonicalForm'   =&gt; 4, // ACCT_FORM_PRINCIPAL
        'baseDn'                 =&gt; 'CN=Users,DC=w,DC=net',
    ),
);

$ldap = new Zend_Ldap();

foreach ($multiOptions as $name =&gt; $options) {

    echo "Trying to bind using server options for '$name'\n";

    $ldap-&gt;setOptions($options);
    try {
        $ldap-&gt;bind($acctname, $password);
        $acctname = $ldap-&gt;getCanonicalAccountName($acctname);
        echo "SUCCESS: authenticated $acctname\n";
        return;
    } catch (Zend_Ldap_Exception $zle) {
        echo '  ' . $zle-&gt;getMessage() . "\n";
        if ($zle-&gt;getCode() === Zend_Ldap_Exception::LDAP_X_DOMAIN_MISMATCH) {
            continue;
        }
    }
}
</pre>
<p>
                If the bind fails for any reason, the next set of server options is tried.
            </p>
<p>
                The <code class="methodname">getCanonicalAccountName()</code> call gets the canonical
                account name that the application would presumably use to associate data with such
                as preferences. The <span class="emphasis"><em>accountCanonicalForm = 4</em></span> in all server
                options ensures that the canonical form is consistent regardless of which
                server was ultimately used.
            </p>
<p>
                The special <code class="constant">LDAP_X_DOMAIN_MISMATCH</code> exception occurs when an
                account name with a domain component was supplied (e.g.,
                <code class="filename">abaker@foo.net</code> or <span class="emphasis"><em>FOO\abaker</em></span> and not just
                <span class="emphasis"><em>abaker</em></span>) but the domain component did not match either domain
                in the currently selected server options. This exception indicates
                that the server is not an authority for the account. In this
                case, the bind will not be performed, thereby eliminating unnecessary
                communication with the server. Note that the <span class="emphasis"><em>continue</em></span>
                instruction has no effect in this example, but in practice for error handling and
                debugging purposes, you will probably want to check for
                <code class="constant">LDAP_X_DOMAIN_MISMATCH</code> as well as
                <code class="constant">LDAP_NO_SUCH_OBJECT</code> and
                <code class="constant">LDAP_INVALID_CREDENTIALS</code>.
            </p>
<p>
                The above code is very similar to code used within <a href="zend.auth.adapter.ldap.html" title="5.5. LDAP 认证"><code class="classname">Zend_Auth_Adapter_Ldap</code></a>.
                In fact, we recommend that you simply use that authentication adapter for
                multi-domain + failover <acronym class="acronym">LDAP</acronym> based authentication
                (or copy the code).
            </p>
</div>
</div>
</div>
</div>
<div class="navfooter"><table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="zend.layout.advanced.html">上一页</a> </td>
<td width="20%" align="center"> </td>
<td width="40%" align="right"> <a accesskey="n" href="zend.ldap.api.html">下一页</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">28.4. Zend_Layout 高级用法 </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td>
<td width="40%" align="right" valign="top"> 29.2. API overview</td>
</tr>
</table></div>
<div class="revinfo"></div>
</body>
</html>
