<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>14.7. Working 范例</title>
<link rel="stylesheet" href="dbstyle.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.72.0">
<link rel="start" href="index.html" title="Zend Framework手册 中文版">
<link rel="up" href="zend.date.html" title="第 14 章 Zend_Date">
<link rel="prev" href="zend.date.constants.html" title="14.6.  一般日期函数的常量">
<link rel="next" href="zend.db.html" title="第 15 章 Zend_Db">
<link rel="chapter" href="introduction.html" title="第 1 章 Zend Framework简介">
<link rel="chapter" href="zend.acl.html" title="第 2 章 Zend_Acl">
<link rel="chapter" href="zend.amf.html" title="第 3 章 Zend_Amf">
<link rel="chapter" href="zend.application.html" title="第 4 章 Zend_Application">
<link rel="chapter" href="zend.auth.html" title="第 5 章 Zend_Auth">
<link rel="chapter" href="zend.cache.html" title="第 6 章 Zend_Cache">
<link rel="chapter" href="zend.captcha.html" title="第 7 章 Zend_Captcha">
<link rel="chapter" href="zend.codegenerator.html" title="第 8 章 Zend_CodeGenerator">
<link rel="chapter" href="zend.config.html" title="第 9 章 Zend_Config">
<link rel="chapter" href="zend.config.writer.html" title="第 10 章 Zend_Config_Writer">
<link rel="chapter" href="zend.console.getopt.html" title="第 11 章 Zend_Console_Getopt">
<link rel="chapter" href="zend.controller.html" title="第 12 章 Zend_Controller">
<link rel="chapter" href="zend.currency.html" title="第 13 章 Zend_Currency">
<link rel="chapter" href="zend.date.html" title="第 14 章 Zend_Date">
<link rel="chapter" href="zend.db.html" title="第 15 章 Zend_Db">
<link rel="chapter" href="zend.debug.html" title="第 16 章 Zend_Debug">
<link rel="chapter" href="zend.dojo.html" title="第 17 章 Zend_Dojo">
<link rel="chapter" href="zend.dom.html" title="第 18 章 Zend_Dom">
<link rel="chapter" href="zend.exception.html" title="第 19 章 Zend_Exception">
<link rel="chapter" href="zend.feed.html" title="第 20 章 Zend_Feed">
<link rel="chapter" href="zend.file.html" title="第 21 章 Zend_File">
<link rel="chapter" href="zend.filter.html" title="第 22 章 Zend_Filter">
<link rel="chapter" href="zend.form.html" title="第 23 章 Zend_Form">
<link rel="chapter" href="zend.gdata.html" title="第 24 章 Zend_Gdata">
<link rel="chapter" href="zend.http.html" title="第 25 章 Zend_Http">
<link rel="chapter" href="zend.infocard.html" title="第 26 章 Zend_InfoCard">
<link rel="chapter" href="zend.json.html" title="第 27 章 Zend_Json">
<link rel="chapter" href="zend.layout.html" title="第 28 章 Zend_Layout">
<link rel="chapter" href="zend.ldap.html" title="第 29 章 Zend_Ldap">
<link rel="chapter" href="zend.loader.html" title="第 30 章 Zend_Loader">
<link rel="chapter" href="zend.locale.html" title="第 31 章 Zend_Locale">
<link rel="chapter" href="zend.log.html" title="第 32 章 Zend_Log">
<link rel="chapter" href="zend.mail.html" title="第 33 章 Zend_Mail">
<link rel="chapter" href="zend.measure.html" title="第 34 章 Zend_Measure">
<link rel="chapter" href="zend.memory.html" title="第 35 章 Zend_Memory">
<link rel="chapter" href="zend.mime.html" title="第 36 章 Zend_Mime">
<link rel="chapter" href="zend.navigation.html" title="第 37 章 Zend_Navigation">
<link rel="chapter" href="zend.openid.html" title="第 38 章 Zend_OpenId">
<link rel="chapter" href="zend.paginator.html" title="第 39 章 Zend_Paginator">
<link rel="chapter" href="zend.pdf.html" title="第 40 章 Zend_Pdf">
<link rel="chapter" href="zend.progressbar.html" title="第 41 章 Zend_ProgressBar">
<link rel="chapter" href="zend.queue.html" title="第 42 章 Zend_Queue">
<link rel="chapter" href="zend.reflection.html" title="第 43 章 Zend_Reflection">
<link rel="chapter" href="zend.registry.html" title="第 44 章 Zend_Registry">
<link rel="chapter" href="zend.rest.html" title="第 45 章 Zend_Rest">
<link rel="chapter" href="zend.search.lucene.html" title="第 46 章 Zend_Search_Lucene">
<link rel="chapter" href="zend.server.html" title="第 47 章 Zend_Server">
<link rel="chapter" href="zend.service.html" title="第 48 章 Zend_Service">
<link rel="chapter" href="zend.session.html" title="第 49 章 Zend_Session">
<link rel="chapter" href="zend.soap.html" title="第 50 章 Zend_Soap">
<link rel="chapter" href="zend.tag.html" title="第 51 章 Zend_Tag">
<link rel="chapter" href="zend.test.html" title="第 52 章 Zend_Test">
<link rel="chapter" href="zend.text.html" title="第 53 章 Zend_Text">
<link rel="chapter" href="zend.timesync.html" title="第 54 章 Zend_TimeSync">
<link rel="chapter" href="zend.tool.framework.html" title="第 55 章 Zend_Tool_Framework">
<link rel="chapter" href="zend.tool.project.html" title="第 56 章 Zend_Tool_Project">
<link rel="chapter" href="zend.translate.html" title="第 57 章 Zend_Translate">
<link rel="chapter" href="zend.uri.html" title="第 58 章 Zend_Uri">
<link rel="chapter" href="zend.validate.html" title="第 59 章 Zend_Validate">
<link rel="chapter" href="zend.version.html" title="第 60 章 Zend_Version">
<link rel="chapter" href="zend.view.html" title="第 61 章 Zend_View">
<link rel="chapter" href="zend.wildfire.html" title="第 62 章 Zend_Wildfire">
<link rel="chapter" href="zend.xmlrpc.html" title="第 63 章 Zend_XmlRpc">
<link rel="chapter" href="zendx.console.process.unix.html" title="第 64 章 ZendX_Console_Process_Unix">
<link rel="chapter" href="zendx.jquery.html" title="第 65 章 ZendX_JQuery">
<link rel="appendix" href="requirements.html" title="附录 A. 系统需求">
<link rel="appendix" href="coding-standard.html" title="附录 B. Zend Framework 的 PHP 编码标准">
<link rel="appendix" href="doc-standard.html" title="附录 C. Zend Framework Documentation Standard">
<link rel="appendix" href="project-structure.html" title="附录 D. Recommended Project Structure for Zend Framework MVC Applications">
<link rel="appendix" href="performance.html" title="附录 E. Zend Framework Performance Guide">
<link rel="appendix" href="copyrights.html" title="附录 F. 版权信息">
<link rel="index" href="the.index.html" title="索引">
<link rel="subsection" href="zend.date.additional.html#zend.date.additional.checking" title="14.7.1.  检查日期">
<link rel="subsection" href="zend.date.additional.html#zend.date.additional.sunrise-sunset" title="14.7.2. 日出和日落">
<link rel="subsection" href="zend.date.additional.html#zend.date.additional.timezones" title="14.7.3. 时区">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader"><table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">14.7. Working 范例 </th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="zend.date.constants.html">上一页</a> </td>
<th width="60%" align="center">第 14 章 Zend_Date</th>
<td width="20%" align="right"> <a accesskey="n" href="zend.db.html">下一页</a>
</td>
</tr>
</table></div>
<div class="sect1" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="zend.date.additional"></a>14.7. Working 范例 </h2></div></div></div>
<p>
        在本章内，我们将描述若干附加的函数，它们在 <code class="code">Zend_Date</code> 中也有效。
        当然所述的函数有另外的范例来示范期望的工作和简单的如何正确使用的 API 。
    </p>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.date.additional.checking"></a>14.7.1.  检查日期 </h3></div></div></div>
<p>
            大部分输入的日期可能是字符串，问题是你不能确保这些字符串是真的日期。因此 <code class="code">Zend_Date</code>
            有个特有的静态函数来加查日期字符串。<code class="code">Zend_Locale</code>  有个特有的函数 <code class="code">getDate($date, $locale);</code> ，它解析
            日期并返回正确的格式化的日期部分。例如月名将被识别和返回月数。
            但 <code class="code">Zend_Locale</code> 不知道什么是日期，因为它是个格式化和本地化的类，所以我们集成了一个特有的函数 <code class="code">isDate($date);</code> 来做这个。
        </p>
<p>
            <code class="code">isDate($date, $format, $locale);</code> 最多可以带 3 个参数但最少需要一个参数。所以我们需要校验的日期当然是它本身是否一个字符串。
            第二个参数是日期的格式。如果没有给定格式，使用地方的标准格式。关于格式的细节参见 <a href="zend.date.constants.html#zend.date.constants.selfdefinedformats" title="14.6.3.  自定义 ISO 输出格式">自定义格式</a> 。
        </p>
<p>
            第三个参数也是可选的并可用于给定一个地方。我们需要地方来格式化月名和天名（monthnames and daynames）。
            所以用第三个参数我们可以根据给定的地方识别 '01.Jänner.2000' 或 '01.January.2000'这样的日期。
        </p>
<p>
            <code class="code">isDate();</code> 当然来检查是否一个日期存在。<code class="code">Zend_Date</code>自己不检查日期。
            所以有可能用 <code class="code">Zend_Date</code>  生成一个如 '31.February.2000'的日期，因为 <code class="code">Zend_Date</code> 将
            自动纠正日期并返回适当的日期，在这个例子中为 '03.March.2000' 。而 <code class="code">isDate()</code> 将检查并对 '31.February.2000' 返回 false，
            因为它知道这是个不可能的日期。
        </p>
<div class="example">
<a name="zend.date.additional.checking.example-1"></a><p class="title"><b>例 14.17. 检查日期</b></p>
<div class="example-contents"><pre class="programlisting">
// Checking dates
$date = '01.03.2000';
if (Zend_Date::isDate($date)) {
    print "String $date is a date";
} else {
    print "String $date is NO date";
}

// Checking localized dates
$date = '01 February 2000';
if (Zend_Date::isDate($date,'dd MMMM yyyy', 'en')) {
    print "String $date is a date";
} else {
    print "String $date is NO date";
}

// Checking impossible dates
$date = '30 February 2000';
if (Zend_Date::isDate($date,'dd MMMM yyyy', 'en')) {
    print "String $date is a date";
} else {
    print "String $date is NO date";
}

            </pre></div>
</div>
<br class="example-break">
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.date.additional.sunrise-sunset"></a>14.7.2. 日出和日落</h3></div></div></div>
<p>
            <code class="code">Zend_Date</code> 也集成了从太阳获得信息的功能。通常在一个特定的日子里获得日出和日落的时间是有必要的。
            用<code class="code">Zend_Date</code> 来做很容易，因为仅仅给定位置就可以计算到日出日落的时间。
        </p>
<p>
            正如很多人不知道他们所居住的城市的位置，我们也使用助手类来提供了世界上大约 250个首都和其它大城市的位置数据。
            大多数人使用他们附近的城市来作为地方，这样计算上会差一点时间。
        </p>
<p>
            用 <code class="code">Zend_Date_Cities::getCityList</code>  可以生成一个列表来选择城市。它返回所有在助手类中预定义的可用的城市名称。
        </p>
<div class="example">
<a name="zend.date.additional.sunrise-sunset.example-1"></a><p class="title"><b>例 14.18.  获得所有可用的城市 </b></p>
<div class="example-contents"><pre class="programlisting">
// Output the complete list of available cities
print_r (Zend_Date_Cities::getCityList());

            </pre></div>
</div>
<br class="example-break"><p>
            用 <code class="code">Zend_Date_Cities::City()</code> 函数可以获得位置。它接受由 <code class="code">Zend_Date_Cities::getCityList()</code> 函数返回的城市名
            和可选的第二个参数来设置地平线（horizon）.
        </p>
<p>
            '<code class="code">effective</code>' horizon is used.
            有 4 个已定义的地平线可用于位置类精确计算日落和日出。'<code class="code">horizon</code>' 参数在所有的函数中总是可选的。
            如果没有指定，则使用 '<code class="code">effective</code>' 。
        </p>
<div class="table">
<a name="zend.date.additional.sunrise-sunset.table"></a><p class="title"><b>表 14.18.  日落和日出支持的地平线（horizons）类型 </b></p>
<div class="table-contents"><table summary=" 日落和日出支持的地平线（horizons）类型 " border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead><tr>
<th>地平线（Horizon）</th>
<th>描述</th>
<th>用法</th>
</tr></thead>
<tbody>
<tr>
<td>effective</td>
<td> 标准地平线 </td>
<td> 认为世界是一个球。这个地平线是缺省值 </td>
</tr>
<tr>
<td>civil</td>
<td>通用地平线</td>
<td>常用于媒体如电视和电台</td>
</tr>
<tr>
<td>nautic</td>
<td>水兵地平线</td>
<td>常用于大海导航</td>
</tr>
<tr>
<td>astronomic</td>
<td>天文学地平线</td>
<td>常用于星际计算</td>
</tr>
</tbody>
</table></div>
</div>
<br class="table-break"><p>
             当然也可以给出和计算自定义位置，因此 '<code class="code">latitude</code>' 和 '<code class="code">longitude</code>' 必需给定，而 '<code class="code">horizon</code>' 是可选的。
        </p>
<div class="example">
<a name="zend.date.additional.sunrise-sunset.example-2"></a><p class="title"><b>例 14.19. 获得一个城市的位置</b></p>
<div class="example-contents"><pre class="programlisting">
// Get the location for a defined city
// uses the effective horizon as no horizon is defined
print_r (Zend_Date_Cities::City('Vienna'));

// use the nautic horizon
print_r (Zend_Date_Cities::City('Vienna', 'nautic'));

// self definition of a location
$mylocation = array('latitude' =&gt; 41.5, 'longitude' =&gt; 13.2446);

            </pre></div>
</div>
<br class="example-break"><p>
            现在所有需要的数据可以被设置了，下一步是创建带有计算日落和日出的日期的 <code class="code">Zend_Date</code> 对象。

            有三个函数用于计算，用 '<code class="code">getSunset()</code>'  计算日落，用 '<code class="code">getSunrise()</code>' 计算日出，所有和太阳相关的信息使用 '<code class="code">getSunInfo()</code>' 。
            经过计算后，<code class="code">Zend_Date</code> 对象返回时就带有计算过的时间。
        </p>
<div class="example">
<a name="zend.date.additional.sunrise-sunset.example-3"></a><p class="title"><b>例 14.20.  计算太阳信息 </b></p>
<div class="example-contents"><pre class="programlisting">
// Get the location for a defined city
$city = Zend_Date_Cities::City('Vienna');

// create a date object for the day for which the sun has to be calculated
$date = new Zend_Date('10.03.2007', Zend_Date::ISO_8601, 'de');

// calculate sunset
$sunset = $date-&gt;getSunset($city);
print $sunset-&gt;get(Zend_Date::ISO_8601);

// calculate all sun informations
$info = $date-&gt;getSunInfo($city);
foreach ($info as $sun) {
    print "\n" . $sun-&gt;get(Zend_Date::ISO_8601);
}

            </pre></div>
</div>
<br class="example-break">
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.date.additional.timezones"></a>14.7.3. 时区</h3></div></div></div>
<p>
            时区和日期一样重要，根据用户所居住的地方，有若干时区，所以使用日期意味着要正确设置时区。
            这听起来很复杂但其实比较简单。正如在 <code class="code">Zend_Date</code> 的第一章所提到的，缺省的时区已经通过 <code class="code">php.ini</code> 或在引导文件（bootstrap file）里定义来设置，
        </p>
<p>
            <code class="code">Zend_Date</code>  对象当然也存储实际的时区。即使在对象创建后修改时区，它也能记住原来的时区并使用它。
            也不必要在使用php函数的代码里修改时区，<code class="code">Zend_Date</code>  有两个内置的函数来处理这个。
        </p>
<p>
            <code class="code">getTimezone()</code>  返回实际的在 <code class="code">Zend_Date</code> 对象里的时区。请记住 <code class="code">Zend_Date</code> 在内部不和 php 耦合，
            返回的时区不是 php 脚本的时区二是对象的时区。
            <code class="code">setTimezone($zone)</code>  是第二个函数并为 <code class="code">Zend_Date</code> 设置新时区。给定的时区总是被检查的，如果不存在就抛出异常。
            另外通过不带区域参数调用 <code class="code">setTimezone()</code> 实际脚本或系统时区可以被设置到日期对象，在对象被创建是这个也会自动完成。
        </p>
<div class="example">
<a name="zend.date.additional.timezones.example-1"></a><p class="title"><b>例 14.21.  使用时区 </b></p>
<div class="example-contents"><pre class="programlisting">
// Set a default timezone... this has to be done within the bootstrap
// file or php.ini
// We do this here just for having a complete example
date_default_timezone_set('Europe/Vienna');

// create a date object
$date = new Zend_Date('10.03.2007', Zend_Date::DATES, 'de');

// view our date object
print $date-&gt;getIso();

// what timezone do we have ?
print $date-&gt;getTimezone();

// set another timezone
$date-&gt;setTimezone('America/Chicago');

// what timezone do we now have ?
print $date-&gt;getTimezone();

// see the changed date object
print $date-&gt;getIso();

            </pre></div>
</div>
<br class="example-break"><p>
            如上面例子的第一行所示，<code class="code">Zend_Date</code>  对创建对象总是使用实际的时区。在被创建的对象里修改时区
            对日期自己有影响。日期总是和时区相关。对 <code class="code">Zend_Date</code>  对象修改时区不会修改 <code class="code">Zend_Date</code>  的时间。
            请记住在内部日期总是以时间戳和 GMT 时区存储。所以时区就意味者对用户所在时区和地区对实际的国际时间的加减。
        </p>
<p>
            在 <code class="code">Zend_Date</code>  里耦合时区有另一个正面影响，在不同的时区有可能有若干个日期。
        </p>
<div class="example">
<a name="zend.date.additional.timezones.example-2"></a><p class="title"><b>例 14.22.  多重时区 </b></p>
<div class="example-contents"><pre class="programlisting">
// Set a default timezone... this has to be done within the bootstrap
// file or php.ini.
// We do this here just for having a complete example.
date_default_timezone_set('Europe/Vienna');

// create a date object
$date = new Zend_Date('10.03.2007 00:00:00', Zend_Date::ISO_8601, 'de');

// view our date object
print $date-&gt;getIso();

// the date stays unchanged even after changeing the timezone
date_default_timezone_set('America/Chicago');
print $date-&gt;getIso();

$otherdate = clone $date;
$otherdate-&gt;setTimezone('Brazil/Acre');

// view our date object
print $otherdate-&gt;getIso();

// set the object to the actual systems timezone
$lastdate = clone $date;
$lastdate-&gt;setTimezone();

// view our date object
print $lastdate-&gt;getIso();

            </pre></div>
</div>
<br class="example-break">
</div>
</div>
<div class="navfooter"><table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="zend.date.constants.html">上一页</a> </td>
<td width="20%" align="center"><a accesskey="u" href="zend.date.html">上一级</a></td>
<td width="40%" align="right"> <a accesskey="n" href="zend.db.html">下一页</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">14.6.  一般日期函数的常量  </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td>
<td width="40%" align="right" valign="top"> 第 15 章 Zend_Db</td>
</tr>
</table></div>
<div class="revinfo"></div>
</body>
</html>
