<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>48.16. Zend_Service_Amazon_Sqs</title>
<link rel="stylesheet" href="dbstyle.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.72.0">
<link rel="start" href="index.html" title="Zend Framework手册 中文版">
<link rel="up" href="zend.service.html" title="第 48 章 Zend_Service">
<link rel="prev" href="zend.service.amazon.s3.html" title="48.15. Zend_Service_Amazon_S3">
<link rel="next" href="zend.service.audioscrobbler.html" title="48.17. Zend_Service_Audioscrobbler">
<link rel="chapter" href="introduction.html" title="第 1 章 Zend Framework简介">
<link rel="chapter" href="zend.acl.html" title="第 2 章 Zend_Acl">
<link rel="chapter" href="zend.amf.html" title="第 3 章 Zend_Amf">
<link rel="chapter" href="zend.application.html" title="第 4 章 Zend_Application">
<link rel="chapter" href="zend.auth.html" title="第 5 章 Zend_Auth">
<link rel="chapter" href="zend.cache.html" title="第 6 章 Zend_Cache">
<link rel="chapter" href="zend.captcha.html" title="第 7 章 Zend_Captcha">
<link rel="chapter" href="zend.codegenerator.html" title="第 8 章 Zend_CodeGenerator">
<link rel="chapter" href="zend.config.html" title="第 9 章 Zend_Config">
<link rel="chapter" href="zend.config.writer.html" title="第 10 章 Zend_Config_Writer">
<link rel="chapter" href="zend.console.getopt.html" title="第 11 章 Zend_Console_Getopt">
<link rel="chapter" href="zend.controller.html" title="第 12 章 Zend_Controller">
<link rel="chapter" href="zend.currency.html" title="第 13 章 Zend_Currency">
<link rel="chapter" href="zend.date.html" title="第 14 章 Zend_Date">
<link rel="chapter" href="zend.db.html" title="第 15 章 Zend_Db">
<link rel="chapter" href="zend.debug.html" title="第 16 章 Zend_Debug">
<link rel="chapter" href="zend.dojo.html" title="第 17 章 Zend_Dojo">
<link rel="chapter" href="zend.dom.html" title="第 18 章 Zend_Dom">
<link rel="chapter" href="zend.exception.html" title="第 19 章 Zend_Exception">
<link rel="chapter" href="zend.feed.html" title="第 20 章 Zend_Feed">
<link rel="chapter" href="zend.file.html" title="第 21 章 Zend_File">
<link rel="chapter" href="zend.filter.html" title="第 22 章 Zend_Filter">
<link rel="chapter" href="zend.form.html" title="第 23 章 Zend_Form">
<link rel="chapter" href="zend.gdata.html" title="第 24 章 Zend_Gdata">
<link rel="chapter" href="zend.http.html" title="第 25 章 Zend_Http">
<link rel="chapter" href="zend.infocard.html" title="第 26 章 Zend_InfoCard">
<link rel="chapter" href="zend.json.html" title="第 27 章 Zend_Json">
<link rel="chapter" href="zend.layout.html" title="第 28 章 Zend_Layout">
<link rel="chapter" href="zend.ldap.html" title="第 29 章 Zend_Ldap">
<link rel="chapter" href="zend.loader.html" title="第 30 章 Zend_Loader">
<link rel="chapter" href="zend.locale.html" title="第 31 章 Zend_Locale">
<link rel="chapter" href="zend.log.html" title="第 32 章 Zend_Log">
<link rel="chapter" href="zend.mail.html" title="第 33 章 Zend_Mail">
<link rel="chapter" href="zend.measure.html" title="第 34 章 Zend_Measure">
<link rel="chapter" href="zend.memory.html" title="第 35 章 Zend_Memory">
<link rel="chapter" href="zend.mime.html" title="第 36 章 Zend_Mime">
<link rel="chapter" href="zend.navigation.html" title="第 37 章 Zend_Navigation">
<link rel="chapter" href="zend.openid.html" title="第 38 章 Zend_OpenId">
<link rel="chapter" href="zend.paginator.html" title="第 39 章 Zend_Paginator">
<link rel="chapter" href="zend.pdf.html" title="第 40 章 Zend_Pdf">
<link rel="chapter" href="zend.progressbar.html" title="第 41 章 Zend_ProgressBar">
<link rel="chapter" href="zend.queue.html" title="第 42 章 Zend_Queue">
<link rel="chapter" href="zend.reflection.html" title="第 43 章 Zend_Reflection">
<link rel="chapter" href="zend.registry.html" title="第 44 章 Zend_Registry">
<link rel="chapter" href="zend.rest.html" title="第 45 章 Zend_Rest">
<link rel="chapter" href="zend.search.lucene.html" title="第 46 章 Zend_Search_Lucene">
<link rel="chapter" href="zend.server.html" title="第 47 章 Zend_Server">
<link rel="chapter" href="zend.service.html" title="第 48 章 Zend_Service">
<link rel="chapter" href="zend.session.html" title="第 49 章 Zend_Session">
<link rel="chapter" href="zend.soap.html" title="第 50 章 Zend_Soap">
<link rel="chapter" href="zend.tag.html" title="第 51 章 Zend_Tag">
<link rel="chapter" href="zend.test.html" title="第 52 章 Zend_Test">
<link rel="chapter" href="zend.text.html" title="第 53 章 Zend_Text">
<link rel="chapter" href="zend.timesync.html" title="第 54 章 Zend_TimeSync">
<link rel="chapter" href="zend.tool.framework.html" title="第 55 章 Zend_Tool_Framework">
<link rel="chapter" href="zend.tool.project.html" title="第 56 章 Zend_Tool_Project">
<link rel="chapter" href="zend.translate.html" title="第 57 章 Zend_Translate">
<link rel="chapter" href="zend.uri.html" title="第 58 章 Zend_Uri">
<link rel="chapter" href="zend.validate.html" title="第 59 章 Zend_Validate">
<link rel="chapter" href="zend.version.html" title="第 60 章 Zend_Version">
<link rel="chapter" href="zend.view.html" title="第 61 章 Zend_View">
<link rel="chapter" href="zend.wildfire.html" title="第 62 章 Zend_Wildfire">
<link rel="chapter" href="zend.xmlrpc.html" title="第 63 章 Zend_XmlRpc">
<link rel="chapter" href="zendx.console.process.unix.html" title="第 64 章 ZendX_Console_Process_Unix">
<link rel="chapter" href="zendx.jquery.html" title="第 65 章 ZendX_JQuery">
<link rel="appendix" href="requirements.html" title="附录 A. 系统需求">
<link rel="appendix" href="coding-standard.html" title="附录 B. Zend Framework 的 PHP 编码标准">
<link rel="appendix" href="doc-standard.html" title="附录 C. Zend Framework Documentation Standard">
<link rel="appendix" href="project-structure.html" title="附录 D. Recommended Project Structure for Zend Framework MVC Applications">
<link rel="appendix" href="performance.html" title="附录 E. Zend Framework Performance Guide">
<link rel="appendix" href="copyrights.html" title="附录 F. 版权信息">
<link rel="index" href="the.index.html" title="索引">
<link rel="subsection" href="zend.service.amazon.sqs.html#zend.service.amazon.sqs.introduction" title="48.16.1. Introduction">
<link rel="subsection" href="zend.service.amazon.sqs.html#zend.service.amazon.sqs.registering" title="48.16.2. Registering with Amazon SQS">
<link rel="subsection" href="zend.service.amazon.sqs.html#zend.service.amazon.sqs.apiDocumentation" title="48.16.3. API Documentation">
<link rel="subsection" href="zend.service.amazon.sqs.html#zend.service.amazon.sqs.features" title="48.16.4. Features">
<link rel="subsection" href="zend.service.amazon.sqs.html#zend.service.amazon.sqs.storing-your-first" title="48.16.5. Getting Started">
<link rel="subsection" href="zend.service.amazon.sqs.html#zend.service.amazon.sqs.queues" title="48.16.6. Queue operations">
<link rel="subsection" href="zend.service.amazon.sqs.html#zend.service.amazon.sqs.messages" title="48.16.7. Message operations">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader"><table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">48.16. Zend_Service_Amazon_Sqs</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="zend.service.amazon.s3.html">上一页</a> </td>
<th width="60%" align="center">第 48 章 Zend_Service</th>
<td width="20%" align="right"> <a accesskey="n" href="zend.service.audioscrobbler.html">下一页</a>
</td>
</tr>
</table></div>
<div class="sect1" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="zend.service.amazon.sqs"></a>48.16. Zend_Service_Amazon_Sqs</h2></div></div></div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.service.amazon.sqs.introduction"></a>48.16.1. Introduction</h3></div></div></div>
<p>
            <a href="http://aws.amazon.com/sqs/" target="_top">Amazon Simple Queue Service
                (Amazon SQS)</a> offers a reliable, highly scalable, hosted
            queue for storing messages as they travel between computers. By
            using Amazon SQS, developers can simply move data between
            distributed components of their applications that perform different
            tasks, without losing messages or requiring each component to be
            always available. Amazon SQS makes it easy to build an automated
            workflow, working in close conjunction with the Amazon Elastic
            Compute Cloud (Amazon EC2) and the other <acronym class="acronym">AWS</acronym> infrastructure web
            services.
        </p>
<p>
            Amazon SQS works by exposing Amazon's web-scale messaging
            infrastructure as a web service. Any computer on the Internet can
            add or read messages without any installed software or special
            firewall configurations. Components of applications using Amazon SQS
            can run independently, and do not need to be on the same network,
            developed with the same technologies, or running at the same time.
        </p>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.service.amazon.sqs.registering"></a>48.16.2. Registering with Amazon SQS</h3></div></div></div>
<p>
            Before you can get started with
            <code class="classname">Zend_Service_Amazon_Sqs</code>, you must first
            register for an account. Please see the <a href="http://aws.amazon.com/sqs/faqs/" target="_top">SQS FAQ</a> page on
            the Amazon website for more information.
        </p>
<p>
            After registering, you will receive an application key and a secret key.
            You will need both to access the SQS service.
        </p>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.service.amazon.sqs.apiDocumentation"></a>48.16.3. API Documentation</h3></div></div></div>
<p>
            The <code class="classname">Zend_Service_Amazon_Sqs</code> class provides
            the <acronym class="acronym">PHP</acronym> wrapper to the Amazon SQS REST interface. Please consult the
            <a href="http://developer.amazonwebservices.com/connect/kbcategory.jspa?categoryID=31" target="_top">Amazon
                SQS documentation</a> for detailed description of the
            service. You will need to be familiar with basic concepts in order
            to use this service.
        </p>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.service.amazon.sqs.features"></a>48.16.4. Features</h3></div></div></div>
<p>
            <code class="classname">Zend_Service_Amazon_Sqs</code> provides the
            following functionality:
        </p>
<div class="itemizedlist"><ul type="disc">
<li><p>
                    A single point for configuring your amazon.sqs
                    authentication credentials that can be used across the
                    amazon.sqs namespaces.
                </p></li>
<li><p>
                    A proxy object that is more convenient to use than an <acronym class="acronym">HTTP</acronym>
                    client alone, mostly removing the need to manually construct
                    <acronym class="acronym">HTTP</acronym> POST requests to access the REST service.
                </p></li>
<li><p>
                    A response wrapper that parses each response body and throws
                    an exception if an error occurred, alleviating the need to
                    repeatedly check the success of many commands.
                </p></li>
<li><p>
                    Additional convenience methods for some of the more common
                    operations.
                </p></li>
</ul></div>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.service.amazon.sqs.storing-your-first"></a>48.16.5. Getting Started</h3></div></div></div>
<p>
            Once you have registered with Amazon SQS, you're ready to create
            your queue and store some messages on SQS. Each queue can contain
            unlimited amount of messages, identified by name.
        </p>
<p>
            The following example demonstrates creating a queue, storing and
            retrieving messages.
        </p>
<div class="example">
<a name="zend.service.amazon.sqs.storing-your-first.example"></a><p class="title"><b>例 48.69. Zend_Service_Amazon_Sqs Usage Example</b></p>
<div class="example-contents"><pre class="programlisting">
$sqs = new Zend_Service_Amazon_Sqs($my_aws_key, $my_aws_secret_key);

$queue_url = $sqs-&gt;create('test');

$message = 'this is a test';
$message_id = $sqs-&gt;send($queue_url, $message);

foreach ($sqs-&gt;receive($queue_url) as $message) {
    echo $message['body'].'&lt;br/&gt;';
}
</pre></div>
</div>
<br class="example-break"><p>
            Since the <code class="classname">Zend_Service_Amazon_Sqs</code> service
            requires authentication, you should pass your credentials (AWS key
            and secret key) to the constructor. If you only use one account,
            you can set default credentials for the service:
        </p>
<pre class="programlisting">
Zend_Service_Amazon_Sqs::setKeys($my_aws_key, $my_aws_secret_key);
$sqs = new Zend_Service_Amazon_Sqs();
</pre>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.service.amazon.sqs.queues"></a>48.16.6. Queue operations</h3></div></div></div>
<p>
            All messages SQS are stored in queues. A queue has to be created
            before any message operations. Queue names must be unique under your
            access key and secret key.
        </p>
<p>
            Queue names can contain lowercase letters, digits, periods (.),
            underscores (_), and dashes (-). No other symbols allowed. Queue
            names can be a maximum of 80 characters.
        </p>
<div class="itemizedlist"><ul type="disc">
<li><p>
                    <code class="methodname">create()</code> creates a new queue.
                </p></li>
<li>
<p>
                    <code class="methodname">delete()</code> removes all messages in
                    the queue.
                </p>
<div class="example">
<a name="zend.service.amazon.sqs.queues.removalExample"></a><p class="title"><b>例 48.70. Zend_Service_Amazon_Sqs Queue Removal Example</b></p>
<div class="example-contents"><pre class="programlisting">
$sqs = new Zend_Service_Amazon_Sqs($my_aws_key, $my_aws_secret_key);
$queue_url = $sqs-&gt;create('test_1');
$sqs-&gt;delete($queue_url);
</pre></div>
</div>
<br class="example-break">
</li>
<li>
<p>
                    <code class="methodname">count()</code> gets the approximate number
                    of messages in the queue.
                </p>
<div class="example">
<a name="zend.service.amazon.sqs.queues.countExample"></a><p class="title"><b>例 48.71. Zend_Service_Amazon_Sqs Queue Count Example</b></p>
<div class="example-contents"><pre class="programlisting">
$sqs = new Zend_Service_Amazon_Sqs($my_aws_key, $my_aws_secret_key);
$queue_url = $sqs-&gt;create('test_1');
$sqs-&gt;send($queue_url, 'this is a test');
$count = $sqs-&gt;count($queue_url); // Returns '1'
</pre></div>
</div>
<br class="example-break">
</li>
<li>
<p>
                    <code class="methodname">getQueues()</code> returns the list of the
                    names of all queues belonging to the user.
                </p>
<div class="example">
<a name="zend.service.amazon.sqs.queues.listExample"></a><p class="title"><b>例 48.72. Zend_Service_Amazon_Sqs Queue Listing Example</b></p>
<div class="example-contents"><pre class="programlisting">
$sqs = new Zend_Service_Amazon_Sqs($my_aws_key, $my_aws_secret_key);
$list = $sqs-&gt;getQueues();
foreach($list as $queue) {
   echo "I have queue $queue\n";
}
</pre></div>
</div>
<br class="example-break">
</li>
</ul></div>
</div>
<div class="sect2" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.service.amazon.sqs.messages"></a>48.16.7. Message operations</h3></div></div></div>
<p>
            After a queue is created, simple messages can be sent into the queue
            then received at a later point in time. Messages can be up to 8KB in
            length. If longer messages are needed please see <a href="http://framework.zend.com/manual/en/zend.service.amazon.s3.html" target="_top">S3</a>.
            There is no limit to the number of messages a queue can contain.
        </p>
<div class="itemizedlist"><ul type="disc">
<li>
<p>
                    <code class="methodname">sent($queue_url, $message)</code> send the
                    <code class="varname">$message</code> to the <code class="varname">$queue_url</code> SQS
                    queue <acronym class="acronym">URL</acronym>.
                </p>
<div class="example">
<a name="zend.service.amazon.sqs.messages.sendExample"></a><p class="title"><b>例 48.73. Zend_Service_Amazon_Sqs Message Send Example</b></p>
<div class="example-contents"><pre class="programlisting">
$sqs = new Zend_Service_Amazon_Sqs($my_aws_key, $my_aws_secret_key);
$queue_url = $sqs-&gt;create('test_queue');
$sqs-&gt;send($queue_url, 'this is a test message');
</pre></div>
</div>
<br class="example-break">
</li>
<li>
<p>
                    <code class="methodname">receive($queue_url)</code> retrieves
                    messages from the queue.
                </p>
<div class="example">
<a name="zend.service.amazon.sqs.messages.receiveExample"></a><p class="title"><b>例 48.74. Zend_Service_Amazon_Sqs Message Receive Example</b></p>
<div class="example-contents"><pre class="programlisting">
$sqs = new Zend_Service_Amazon_Sqs($my_aws_key, $my_aws_secret_key);
$queue_url = $sqs-&gt;create('test_queue');
$sqs-&gt;send($queue_url, 'this is a test message');
foreach ($sqs-&gt;receive($queue_url) as $message) {
    echo "got message ".$message['body'].'&lt;br/&gt;';
}
</pre></div>
</div>
<br class="example-break">
</li>
<li>
<p>
                    <code class="methodname">deleteMessage($queue_url, $handle)</code>
                    deletes a message from a queue. A message must first be
                    received using the <code class="methodname">receive()</code> method
                    before it can be deleted.
                </p>
<div class="example">
<a name="zend.service.amazon.sqs.messages.deleteExample"></a><p class="title"><b>例 48.75. Zend_Service_Amazon_Sqs Message Delete Example</b></p>
<div class="example-contents"><pre class="programlisting">
$sqs = new Zend_Service_Amazon_Sqs($my_aws_key, $my_aws_secret_key);
$queue_url = $sqs-&gt;create('test_queue');
$sqs-&gt;send($queue_url, 'this is a test message');
foreach ($sqs-&gt;receive($queue_url) as $message) {
    echo "got message ".$message['body'].'&lt;br/&gt;';

    if ($sqs-&gt;deleteMessage($queue_url, $message['handle'])) {
        echo "Message deleted";
    }
    else {
        echo "Message not deleted";
    }
}
</pre></div>
</div>
<br class="example-break">
</li>
</ul></div>
</div>
</div>
<div class="navfooter"><table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="zend.service.amazon.s3.html">上一页</a> </td>
<td width="20%" align="center"><a accesskey="u" href="zend.service.html">上一级</a></td>
<td width="40%" align="right"> <a accesskey="n" href="zend.service.audioscrobbler.html">下一页</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">48.15. Zend_Service_Amazon_S3 </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td>
<td width="40%" align="right" valign="top"> 48.17. Zend_Service_Audioscrobbler</td>
</tr>
</table></div>
<div class="revinfo"></div>
</body>
</html>
